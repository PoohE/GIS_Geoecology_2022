<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Data Mining</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<style>
* {
  box-sizing: border-box;
}


figure {
    width: 50%; /* Ширина если надо расположить 2 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 0%; /* Поля */
   }
   figure:first-child {
    margin-left: 0; /* Убираем отступ для первого элемента */
   }

picture {
 width: 33%; /* Ширина если надо расположить 3 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 0%; /* Поля */
}
picture:first-child {
    margin-left: 0; /* Убираем отступ для первого элемента */
   }

   image {
    width: 100%; /* Ширина если надо расположить 1 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 1%; /* Поля */
   }

</style>
</head>
<body>
	
	<div class="sidenav">
<a href="#h1">II. БАЗОВЫЕ ПРОЦЕДУРЫ ОПЕРИРОВАНИЯ С ДАННЫМИ В ГЕОЭКОЛОГИИ</a>

<a href="#h2">7. ИЗВЛЕЧЕНИЕ ДАННЫХ И ОВЕРЛЕЙ СЛОЕВ В ГИС: ОСНОВНЫЕ СЮЖЕТЫ И ИНСТРУМЕНТЫ</a>

   <a href="#h3_1">7.1. ГИС-моделирование в геоэкологии: типичные блоки</a>
   <a href="#h3_2">7.2. Типы слоев ОТЕ и переменных в составе модели</a>
   <a href="#h3_3">7.3. Извлечение данных и взаимоотношения слоев в оверлее</a>
   <a href="#h3_4">7.4. Инструменты извлечения данных растровых "полей"</a>
   <a href="#h3_5">7.5. Инструменты извлечения данных растровых "мозаик"</a>
   <a href="#h3_6">7.6. Инструменты извлечения дисперсных векторных данных</a>
   <a href="#h3_7">7.7. Инструменты извлечения данных векторных "мозаик"</a>



  </div>

    <div class="content">

<h1 id="h1">II. БАЗОВЫЕ ПРОЦЕДУРЫ ОПЕРИРОВАНИЯ С ДАННЫМИ В ГЕОЭКОЛОГИИ</h1>

<h2 id="h2"><h2>7. ИЗВЛЕЧЕНИЕ ДАННЫХ И ОВЕРЛЕЙ СЛОЕВ В ГИС: ОСНОВНЫЕ СЮЖЕТЫ И ИНСТРУМЕНТЫ</h2>

	<h3 id="h3_1"><h3>7.1. ГИС-моделирование в геоэкологии: типичные блоки </h3>

<p>Техника геоэкологического моделирования в значительной степени аналогична технике любого современного моделирования, сопряженного с алгоритмами, основанными на законах формальной логики и математическом аппарате. Однако, корневые части понятия «геоэкологическое» - <strong>«гео»</strong> и <strong>«эко»</strong> определяют, тем не менее, специфику, которая находит выражение в специфических типичных блоках такого рода моделей, включающих, как правило:</p>
<ol type="1">
    <li>Представление о содержании модели (гипотеза);</li>
    <li>Представление о «сценах», т.е., пространственном охвате и границах ареала моделирования (экорегион или ландшафт, физико-географический район или речной бассейн, административная область или муниципальный район, городской район, и т.д.);</li>
	<li>Представление об алгоритме и методах анализа (набор и последовательность шагов моделирования, применяемые инструменты);</li>
	<li>Представление об операционно-территориальных единицах моделирования (ландшафтные урочища, элементарные водосборы, сельскохозяйственные угодья, единицы административно-территориального деления и т. д.);</li>
	<li>Представление о характере исходных данных, способах «добычи», извлечения, (Data Mining) преобразовании.</li>
</ol>

<p>Очевидно, что блоки тесно связаны между собой, поскольку  гипотеза моделирования определяет  размерность и конфигурацию сцены, тип и набор операционно-территориальных единиц (ОТЕ), состав и последовательность используемых инструментов (алгоритм). В свою очередь,  инструменты гис-моделирования требуют  определенный тип данных «на входе», что обусловливает специфику их поиска и характер предварительного преобразования.

<p>Традиционно геоэкологическое моделирование включает значительное разнообразие «сюжетов», или, как теперь принято выражаться – «кейсов», каждому их которых свойственны свои параметры выбираемых сцен, наборы ОТЕ и применяемые алгоритмы. В этом смысле моделирование заболеваемости по разным нозологиям с попыткой поиска вызывающих те или иные болезни причин будет отличаться от модели, направленной на решение задачи оптимального размещения полигона для коммунальных бытовых отходов.  Но, так или иначе, практически любая геоэкологическая модель обязательно содержит несколько типичных процедур, реализуемых (обычно) на начальных этапах построения модели: </p>
<ol type="A">
    <li>Загрузка и отображение данных - переменных, показателей, индикаторов (например,  открытие растрового слоя абсолютных высот, с автоматическим оформлением в виде так называемой "растяжки"|"stretching" в "тонах серого" <span class="red">ArcMAP10.x</span>) или в цвете <span class="blue">SAGA GIS</span>;</li>
	<li>Ранжирование и классифицирование данных (например, классификация растрового слоя абсолютных высот одним из способов – естественные границы, квантиль, равный интервал и т.д.);</li>
	<li>Извлечение данных в элементы выбранной сетки ОТЕ (районов АТД, речных  бассейнов, физико-географических районов, квадратов принятой размерности, и проч.); </li>
	<li>Осуществление операций ранжирования, классифицирования, группирования, кластеризации  ОТЕ по набору переменных (например классификация районов города по наличию и составу зеленой инфраструктуры или кластеризация речных бассейнов по удельной длине русловой сети, проценту лесистости, распаханности и застроенности).</li>
</ol>

<p>В результате исследователь получает набор новых слоев, которые либо позволяют ему совершать различные аналитические действия (сравнение, обобщение), и «предлагают» основу для разработки практических  решений  относительно (если продолжить выше приведенные примеры) мероприятий по озеленению городских кварталов или экореабилитации долинно-речной сети..
</p>
<br>


	<h3 id="h3_2"><h3>7.2. Типы слоев ОТЕ и переменных в составе модели</h3>

<p>От того, какими типами слоев представлены операционно-территориальные единицы (ОТЕ) и привлеченные для анализа данные будут завесить состав и содержание алгоритмов будущей модели.  Операционно-территориальные единицы, как правило, представлены векторными слоями. <strong>Растровые ОТЕ</strong> <span class="bolditalic">встречаются редко, и, как правило, представляют собой промежуточной вариант, используемый для получения каких-то значений, например - значений зональной статистики по набору других растровых слоев</span>.

<p>В свою очередь, <strong>векторные операционно-территориальные единицы</strong> <span class="bolditalic">могут быть файлами полигонов, и это наиболее распространенный вариант, поскольку все обычные «носители» информации: страны и районы, водосборы и ландшафты, представляют собой ареалы и  отображаются полигонами. Но ОТЕ также могут быть представлены точками, например - точками отбора почвенных проб в геоэкологической модели или точками населенных пунктов в средне- и мелкомасштабной модели системы расселения</span>.. 

<p>Реже, но тем не менее встречаются ОТЕ  полилинии, которые например удобно использовать как плечи графа, отображающего  загруженность  автомобильных дорог; отрезки полилиний  могут оказаться удобными  и для моделирования экологических  характеристик речных сетей.<p>

<p><strong>Переменные в составе модели</strong> также могут быть и векторными, и растровыми. Таким образом в векторных моделях геометрические примитивы (полигоны, полилинии и точки) могут использоваться и как ОТЕ, и как данные. Здесь важно не запутаться: если векторная точка отображает только локализацию явления (например - местонахождения редкого вида флоры), то она играет роль переменной. Но если эти же точки содержат атрибуты (например оценку состояния и/или возраста растений), то мы можем включать их в модель в качестве  операционно-территориальными единиц.</p> 

<p>Также <strong>векторными</strong> в качестве <strong>исходных данных</strong> могут быть полигоны сельскохозяйственных угодий, или выделы лесных кварталов с соответствующими характеристиками - в том случае если их атрибуты обобщаются по другой пространственной сетке ОТЕ. Например, если контура полей с показателями урожайности учитываются в районировании сельскохозяйственных предприятий, представленных полигонами их границ. Точно также кварталы с показателями возраста древостоя будут данными для модели, в которой роль ОТЕ отведена лесничествам.</p> 

<p>В роли векторных  переменных  могут «оказаться» полилинии дорог (в задаче оценки доступности) или рек (в задаче расчета их плотности по бассейнам). Векторные данные могут содержать только атрибуты собственной геометрии (длину, площадь, периметр), либо значения, которыми они наделены: число элементов или иные свойства, выраженные в специальных шкалах.</p>

<p><strong>Растровые форматы данных</strong> в составе моделей весьма разнообразны; различают данные -  непрерывные «поля значений», например, так называемые Цифровые Модели Рельефа (и большая часть производных от них метрик), растры атрибутированных классов (например данные LULC - растры земельного и ландшафтного покрова). В свою очередь, атрибутированные  растровые данные могут быть разделены в зависимости от характера исходных значений и используемых шкал.</p>

<p><strong>Шкалы</strong> <span class="bolditalic">как векторных, так и растровых данных могут соответствовать всем типам, описанным и используемым в статистике, т.е., быть номинальными, порядковыми, интервальными и количественными со шкалой отношений</span>.</p>


Таблица 7.1  Основные виды шкалирования данных, используемых в геоинформационных моделях

<table id="customers">
      <table border="1">
        <tr>
            <th>Виды шкалирования данных</th>
            <th colspan="3"style="text-align:center";>Векторные данные</th>
            <th>Растровые данные</th>
        </tr>
        </tr>
        <tr>
            <th>Виды геометрии слоя данных</th>
            <th>Точки</th>
            <th>Линии</td>
            <th>Полигоны</td>
            <th>Пиксели растра (грида)</th>
        </tr>
        <tr>
            <td>Номинальные </td>
            <td>Название города<br> (Орел, Тула, Кострома</td>
            <td>Наименование трассы ("Дон", "M8")</td>
            <td>Почтовый индекс городского квартала</td>
            <td>Типы покрытий согласно классификатору Land Cover (леса, акватории)</td>
        </tr>
        <tr>
            <td>Порядковые</td>
            <td>Классификации городов по<br> численности / размерам / функциям<br> (мегаполисы, города-миллионники,<br> областные центры,<br> райцентры)</td>
            <td>Классификации трасс (федеральная, областная, районная)</td>
            <td>Морфотипы кварталов (купеческие, "сталинский ампир")</td>
            <td>Классы возраста лесов (молодые, зрелые, перестойные леса)</td>
        </tr>
        <tr>
            <td>Интервальные</td>
            <td>Индекс комфортности<br> городской среды</td>
            <td>Ширина проезжей части дороги</td>
            <td>Интервалы плотности застройки квартала (высокая, средняя, низкоплотная застройка)</td>
            <td>Интервалы высотной поясности</td>
        </tr>
        <tr>
            <td>Количественные</td>
            <td>Численность<br> населения города</td>
            <td>Нагрузка в экипажах в час</td>
            <td>Плотность застройки квартала (63%)</td>
            <td>Абсолютная высота</td>
        </tr>
</table>
<br>

<p>Устанавливать тип данных, привлекаемых в модель, чрезвычайно важно по двум причинам: 
во-первых, для разных типов данных могут быть рассчитаны разные статистики, и эта специфика во-многом определяет содержание выстраиваемой модели; 	во-вторых, разные данные «диктуют» свои отношения в паре «переменные» - «ОТЕ».<p>

<p>Так, номинальные данные (будучи извлеченными в ОТЕ) могут использоваться для группирования (кластеризации).  Но использовать их для проведения других видов анализа сложно. Для порядковых шкал можно применять частотный анализ и вычислять медиану, а вот вычисление среднего – не всегда имеет смысл. Наибольшие возможности для анализа предоставляют данные, выраженные в количественных шкалах отношений. <span class="bolditalic">Разные по составу пары данных (ОТЕ-переменные) обрабатываются разными инструментами геоинформационных систем.</span>
<br>
<br>

<h3 id="h3_3"><h3>7.3. Извлечение данных и взаимоотношения слоев в оверлее</h3>

<p>Экологические оценки, а следовательно, и геоэкологическое моделирование (и картографирование) предполагают прежде всего извлечение данных в сетку ОТЕ.  Действительно, мы редко рассуждаем о «загрязнении вообще», но, как правило, говорим о загрязнении того или иного района. Точно также мы анализируем заболеваемость по муниципальным районам или  заболоченность по речным бассейнам, или  пожароопасность по лесным кварталам; во всех этих случаях заболеваемость, заболоченность и пожароопасность представляют собой данные (признаки, переменные, факторы), а районы, бассейны, и лесные кварталы  - сетки операционно-территориальных единиц. <span class="bolditalic">Виды Исходных Данных (ИД) и виды  операционно-территориальных единиц (ОТЕ) определяют и типологию возможных взаимоотношений между слоями в геоинформационной модели</span>.

<p>Отношение слоев исходных данных (ИД) и слоев ОТЕ, часто называемые оверлеем (overlay – наложение) реализуется при ГИС-моделировании в принципиально разной логике.</p>

<a id="Таблица 7.2"><span class="imgtitle">Таблица 7.2 Типы  взаимоотношений слоев ОТЕ и Исходных Данных в рамках формальной логики

<table id="customers">
      <table border="1">
        <tr>
            <th>№</th>
            <th>Логические типы взаимоотношений ИД и ОТЕ</th>
            <th>Типы слоев  ИД и ОТЕ</td>
            <th>Решаемая задача извлечения (пример) </td>
        </tr>
        <tr>
        	<td>1.1</td>
            <td>«Континуальное поле ко Многим»</td>
            <td>ИД: растр-«поле»; ОТЕ: полигональный вектор</td>
            <td>Извлечение статистик (среднее, медиана, максимальное, минимальное, дисперсия и разброс значений) в полигоны - например, высот растра ЦМР в сетку районов города ("средняя высота поверхности" в районе)</td>
        </tr>
        <tr>
        	<td>1.2</td>
        	<td>«Континуальное поле ко Многим»</td>
            <td>ИД: растр-«поле»; ОТЕ: вектор полилиний</td>
            <td>Извлечение значений растра ЦМР в отрезки полилиний для построения профиля земной поверхности </td>
        </tr>  
        <tr>
            <td>1.3</td>
            <td>«Континуальное поле ко Многим»</td>
            <td>ИД: растр-«поле»; ОТЕ: вектор точек</td>
            <td>Извлечение значений растра ЦМР в точки для выявление абсолютной высоты для набора точек заложения разведочных геологических скважин на территории</td>
         </tr>  
         <tr>
         	<td>2.1</td>
            <td>«Дисперсное поле ко Многим»</td>
            <td>ИД: атрибутированный номинальный бинарный растр (0,1);
			ОТЕ: полигональный вектор</td>
            <td>Расчет числа пикселей в каждом полигоне ОТЕ для определения доли площади древесного полога (по растру Tree Cover, со значениями "1-древесный полог", "0-отсутствие древостоя") от общей площади административных районов</td>
         </tr>  
         <tr>
            <td>2.2</td>
            <td>«Дисперсное поле ко Многим»</td>
            <td>ИД: вектор полигонов с бинарным  атрибутом 1,0 и параметром площади для значения "1"; ОТЕ: полигональный вектор</td>
            <td>Пересечение (Intersection) векторных полигональных слоев ИД и ОТЕ для определения доли лесопокрытой площади от общей площади водосбора для сетки речных бассейнов</td>
         </tr>
         <tr>
            <td>2.3</td>
            <td>«Дисперсное поле ко Многим»</td>
            <td>ИД: вектор полигонов с бинарным  атрибутом 1,0 и параметром площади для значение "1"; ОТЕ:  вектор полилиний</td>
            <td>Пересечение (Intersection) векторного слоя полилиний ЛЭП с полигональным слоем лесной растительности для выявления участков ЛЭП, проходящих через лесные массивы</td>
        </tr>  
        <tr><td>2.4</td>
        	<td>«Линейный граф ко Многим»</td>
        	<td>ИД: вектор полилиний с геометрическим  атрибутом (длина); ОТЕ: вектор полигонов </td>
        	<td>Пересечение (Intersection) векторного слоя полилиний автодорог с полигональным слоем сельских районов для вычисления плотности автомобильных дорог по районам</td>
        </tr> 
        <tr><td>2.5</td>
            <td>«Точки наблюдения/явления ко Многим»</td>
            <td>ИД: вектор точек единственного класса; ОТЕ: вектор полигонов </td>
            <td>Пересечение (Intersection) векторного слоя точек со слоем полигонов сельских районов для вычислений числа и общей площади   несанкционированных свалок ТБО по районам </td>
        </tr> 
         <tr>
            <td>3.1</td>
            <td>«Мозаика или Многое ко Многим»</td>
            <td>ИД: атрибутированный номинальный  растр, ОТЕ:  вектор точек
			</td>
            <td>Извлечение значений растра по классам  в точки для определения типов гидрогеологических слое, подстилающих водозаборные скважины</td>
        </tr>  
        <tr><td>3.2</td>       
        	<td>«Мозаика или Многое ко Многим»</td>
        	<td>ИД: атрибутированный номинальный  растр, ОТЕ: полигональный вектор
			</td>
        	<td>Извлечение значений растра по классам (сумма) в полигоны ОТЕ для определения  доли площади разных видов землепользования в каждом муниципальном  районе</td>
        </tr>
        <tr><td>3.2</td>       
            <td>«Мозаика или Многое ко Многим»</td>
            <td>ИД: полигональный вектор с классифицированным атрибутом, ОТЕ: полигональный вектор</td>
            <td>Пересечение (Tabulate Intersection) полигонов с классифицированным атрибутом с полигонами сетки ОТЕ для определения доли площади разных видов землепользования в каждом муниципальном  районе</td>
        </tr>
        <tr><td>3.3</td>       
        	<td>«Мозаика или Многое ко Многим»</td>
            <td>ИД: атрибутированный номинальный  растр, ОТЕ:  вектор полилиний
            </td>
            <td>Извлечение значений растра по классам (сумма) в отрезки полилиний для определения типов LULC земельно-ландшафтного покрова вдоль автомагистрали</td>
        </tr>
        
         </table>

<br>
<br>


<h4 id="h3_4"><h3>7.4. Инструменты извлечения данных растровых "полей"</h3>

<p><b>«Континуальное поле ко Многим»</b>: <span class="bolditalic">ИД - растр-«поле», ОТЕ - векторный полигональный слой</span>. Извлечение данных растровых полей в один из вариантов векторной матрицы – едва ли не наиболее распространенная процедура начальных этапов геоинформационного моделирования. Классическим примером «сырого» растра является <span class="monospace">Цифровая Модель Рельефа (DEM)</span> земной поверхности, работа с которым привела к возникновению теории так называемого «рельеф-поля» <a href="BIBLIO.html#Lastochkin_1987">[Ласточкин, 1987].</a>  Варианты извлечения значений из ЦМР (1.1 - 1.3, <a href="#Таблица 7.2">Табл. 7.2</a>)   различаются инструментально для разных типов векторных матриц, но во всех случаях отражают отношение  <strong>Континуальное поле ко Многим»</strong>. Мы будем рассматривать инструменты извлечения на примере растрового слоя <span class="monospace">ЦМР</span> и векторного слоя районов <span class="monospace">АТД «Старой» Москвы</span> <a href="#01_relief_moscow">(Рис. 7.1)</a>.</p>


<table id="customers">
      <table border="0">
        <tr>
            <td><a id="01_relief_moscow"><img src="Pict_2_7/01_relief_moscow.png" width="180" height="210"></a></td>
            <td><a id="00_moscow_matrix"><img src="Pict_2_7/00_moscow_matrix.png" width="180" height="210"></a></td>
            <td><a id="w01_relief_regeion"><img src="Pict_2_7/01_relief_regeion.png" width="180" height="210"></a></td>
        </tr>
</table>


<span class="imgtitle">Рис. 7.1 a) Цифровая модель рельефа на территорию "Старой" Москвы  - отображение "растяжка" при загрузке в <span class="red">ArcMAP10.x</span>, b) сетка административных районов «Старой» Москвы, c) визуальный оверлей слоев районов АТД и растра ЦМР

<p>Итак, если в модели в качестве сетки операционно-территориальных единиц используются  полигоны, а в качестве данных – растр-поле, то можно извлечь значения растра в единицы сетки, в данном случае значение поля высот в районы АТД. В <span class="red">ArcMAP10.x</span> для решения этой задачи используется инструмент <span class="blackbold">Zonal Statistic|Зональная Статистика</span> из набора <span class="monospace">Zone (Зональные)</span> группы  <span class="monospace">Spatial Analyst Tools|Инструменты Пространственного Анализа</span>.</p>
<br>

<img src="Pict_2_7/03_zonal_stat.png" width="35%", height="relative">
<br>
<span class="imgtitle">Рис. 7.2 Диалоговое окно инструмента Zonal Statistic ArcMAP10.x</span>
<br>

 <p>В диалоговом окне инструмента <span class="blackbold">Зональная Статистика</span> необходимо выбрать интересующий нас вид статистики из десяти предлагаемых <a href="#Таблица 7.3">(Таблица 7.3)</a>.</p>

<a id="Таблица 7.3"><span class="imgtitle">Таблица 7.3 Описание основных статистик, используемых в операциях извлечения растровых значений в векторные ОТЕ

<table id="customers">
      <table border="1">
        <tr>
            <th>№</th>
            <th>Вид статистики</th>
            <th>Значение</th>
            <th>Содержание</th>
        <tr>
            <td>1</td>
            <td>MEAN</td>
            <td>Среднее</td>
            <td>Вычисляет среднее значение в пределах данной единицы матрицы ОТЕ (района, бассейна, квартала и проч.)</td>
        </tr>
        <tr>
            <td>2</td>
            <td>MEDIAN</td>
            <td>Медиана</td>
            <td>Значение в пределах зоны (района, бассейна, квартала и проч.) характеризующееся тем, что половина всех значений ячеек больше данного, а половина - меньше</td>
        </tr>  
        <tr>
            <td>3</td>
            <td>MAJORITY</td>
            <td>Большинство</td>
            <td>Определяет значение, которое чаще всего встречается во всех ячейках растра значений, принадлежащих к той же зоне (району, бассейну, кварталу и проч.)</td>
         </tr>  
         <tr>
            <td>4</td>
            <td>MINORITY</td>
            <td>Меньшинство</td>
            <td>Определяет самое редкое значение в пределах данной  зоны (района, бассейна, квартала и проч.)</td>
         </tr>  
         <tr>
            <td>5</td>
            <td>MAXIMUM</td>
            <td>Максимум</td>
            <td>Максимальное значение в пределах зоны</td>
         </tr>
         <tr>
            <td>6</td>
            <td>MINIMUM»</td>
            <td>Минимум</td>
            <td>Минимальное значение в пределах зоны</td>
        </tr>  
        <tr>
            <td>7</td>
            <td>RANGE</td>
            <td>Диапазон</td>
            <td>Разница между минимальным и максимальным значением в пределах данной зоны, таким образом характеризует разброс значений внутри каждого полигона</td>
        </tr>  
        <tr><td>8</td>       
            <td>VARIETY</td>
            <td>Разнообразие</td>
            <td>Вычисляет количество уникальных значений для всех ячеек растра значений, принадлежащих к той же зоне (полигону), таким образом характеризуя «кучность» облака значений</td>
        </tr>
        <tr><td>9</td>       
            <td>STD</td>
            <td>Среднеквадр. откл.</td>
            <td>Среднеквадратическое отклонение значений каждой зоны (полигона)</td>
        </tr>
        <tr><td>10</td>       
            <td>SUM</td>
            <td>Сумма</td>
            <td>Общая сумма всех значений данной зоны (полигона)</td>
        </tr>
         </table>

<p>Выбор определяется задачами моделирования: если для примера использовать в качестве "поля" грид высот (ЦМР), то <span class="cursive">максимум</span> и <span class="cursive">минимум</span> -  это самые высокие и самые низкие точки в районе, они могут быть полезны, если мы ищем видовую точки (самое высокое место), или место, куда будут собираться загрязненные стоки в случае аварии и разлива нефтепродуктов (самое низкое место). Соответственно <span class="cursive">среднее арифметическое</span> - некая обобщенная характеристика высоты, но лучшее представление об «высотности» района на самом деле даст <span class="cursive">медиана</span>.  <span class="cursive">Диапазон</span> характеризует общий перепад высот и может пригодится если нас интересует сложность проектируемой трассы лыжной трассы. <span class="cursive">Среднее квадратическое отклонение</span>  дает представление о разбросе или наоборот - монотонности значений, т.е.,  в данном случае о сложности и пересеченности рельефа. На выходе инструмента <span class="blackbold">Зональная Статистика</span> – новый растр, «мозаика» которого образована контурами районов АТД. В ряде случаев такой результат приемлем  - поскольку дает наглядное представление о демонстрируемом свойстве. Полученное значение выбранной статистики можно затем извлечь в векторный файл полигонов; однако <span class="red">ArcMAP10.x</span> предоставляет значительно более удобный инструмент для этой цели <span class="blackbold">Zonal Statistics as Table|Зональная Статистика в Таблицу</span>.</p>

<br>
<img src="Pict_2_7/04_zonal_st_as_table.png" width="35%", height="relative">
<br>
<span class="imgtitle">Рис. 7.3 Инструмент Zonal Statistics as Table</span>


<p><span class="blackbold">Zonal Statistics as Table|Зональная статистика в таблицу</span>, находится в том же наборе  <span class="monospace">Zone|Зональные</span> группы <span class="monospace">Spatial Analyst Tools</span>, и позволяет получить сразу все возможные статистики в виде таблицы, которую потом придется «подшивать», т.е., присоединять к векторному файлу полигонов ОТЕ, используя поле <span class="monospace">уникального идентификатора</span> <span class="monospace">ID</span>.</p>
<br>

<img src="Pict_2_7/36_table_zone_as_table.png" width="65%", height="relative">
<br>
<span class="imgtitle">Рис. 7.4 Результат расчета инструмента Zonal Statistics as Table  со статистиками грида высот для районов "Старой" Москвы </span>

<p>Поля таблицы <a href="#36_table_zone_as_table">(Рис. 7.4)</a> содержат выбранные характеристики (опция <span class="monospace">All</span> позволяет выбрать все сразу). Соединение с шейпом районов устанавливается обычным способом  - подсвечиванием слоя  и выборкой опции <span class="monospace">Join</span> по щелчку правой кнопки мыши.</p>
<br>

<img src="Pict_2_7/37_join_table.png" width="70%", height="relative">
<br><span class="imgtitle">Рис. 7.5 Присоединение таблицы с извлеченными значениями статистик  к шейп-файлу районов</span>
<br>

<p>После присоединения лучше создать копию исходного слоя ОТЕ с новым названием, используя функцию  <span class="monospace">DATA >> Export DATA</span>. Далее можно оформлять полученный составной слой по любому выбранному признаку.</p>
<br>

<img src="Pict_2_7/38_join_table_range.png" width="90%", height="relative">
<br><span class="imgtitle">Рис. 7.6 Значение диапазона высот в административных районах «Старой» Москвы</span>

<p>В <span class="blue">SAGA GIS</span> для извлечения значений растра в сетку полигонов запускаем инструмент  <span class="blackbold">Grid Statistic for Polygon|Статистика грида в полигон</span> из набора  <span class="monospace">Shapes-Grid Tools|Шейп-Грид инструменты</span> группы <span class="monospace">Shapes (Шейп-файлы)</span>.</p>
<br>

<img src="Pict_2_7/310_grid_stat_polygon.png" width="70%", height="relative">
<br><span class="imgtitle">Рис. 7.7 Инструмент Grid Statistic for Polygon SAGA GIS</span>

<p>Инструмент <span class="blackbold">Grid Statistic for Polygon</span> предлагает получить полный комплект возможных статистик за один «прогон», причем данные будут «подшиты» к шейпу (новый файл не образуется) в виде добавленных полей (столбцов таблицы слоя), названия которых можно корректировать на вкладке установок слоя <span class="monospace">Setting</span> в позиции <span class="cursive">Name</span>.</p>
<br>

<img src="Pict_2_7/310_dialig_saga_sone_stat.png" width="35%", height="relative">
<br><span class="imgtitle">Рис. 7.8 Диалоговое окно Grid Statistic for Polygon SAGA GIS</span>

<p>По сути это та же зональная статистика, однако в <span class="blue">SAGA GIS</span> реализована возможность выбор метода расчета <span class="cursive">Method</span>: можно применить «простой и быстрый», либо учитывающий площадь и/или вес ячеек с тем или иным значением. Целесообразно  также выбрать способ наименования новых полей во вкладке <span class="monospace">Field naming >> Method</span>: лучше чтобы оставался только номер грида – тогда остается место для самой переменной, в противном случае придется переименовывать названия вручную.</p>

<p>В <span class="blue">SAGA</span> для просмотра  результата надо «встать» на наименование слоя в <span class="monospace">DATA</span> и по правой кнопке мыши запросить показ атрибутов <span class="monospace">Attributes >> Show</span>.</p>

<p>Также как и в <span class="red">ArcMAP10.x</span>, шейп в <span class="blue">SAGA GIS</span>  может быть оформлен по любому из полей. Для этого выбираем <span class="monospace">Fill style >> Opaque; Type >> Graduated Color; Attribute >> Признак H_Mean</span>  и любое количество цветов в палитре.</p>
<br>

<img src="Pict_2_7/313_saga_map_statist.png" width="300", height="300">
<br><span class="imgtitle">Рис. 7.9 Оформление карты средней высоты поверхности по сетке районов "Старой" Москвы в SAGA GIS</span>
<br>

<p><b>Континуальное поле ко Многим</b>: <span class="bolditalic">исходные данные - растр-«поле», ОТЕ - вектор точек</span>. Извлечение значений растра (или набора растров) в точки – популярная и часто используемая процедура.  Например, при экспертном (первоначальном) выборе места для объекта капитального строительства на значительной по размеру территории такая локальная площадка  может  рассматриваться  как «точка», а условия и параметры множества точек могут устанавливаться извлечением  данных различных тематических растров, характеризующих рельеф, геологию, климат и т.д.</p>  

<p>Предположим, что нас интересуют свойства центральных точек (центроидов) районов АТД Москвы, в частности – параметры рельефа.</p>
<br>

<img src="Pict_2_7/314_raster_in_points_arcmap.png" width="50%", height="relative">
<br><span class="imgtitle">Рис. 7.10  Центроиды районов АТД "Старой" Москвы на фоне растра ЦМР в отображении "растяжка"</span>

<p>В <span class="red">ArcMAP10.x</span> для решения этой задачи служит инструмент <span class="blackbold">Extract Values to Points|Извлечь Значения в Точки</span> или его «родной брат», извлекающий значение из нескольких растров <span class="blackbold">Extract Multi Values to Points|Извлечь Значения Многих Растров в Точки</span>. Результат «подшивается» в виде нового поля <span class="cursive">DEM_Moscow</span>.</p> 

<img src="Pict_2_7/315_extract_values_to_points_arc.png" width="60%", height="relative">
<br>
<span class="imgtitle">Рис. 7.11 Скриншот таблицы шейпа - выходные значения высот точек центроидов 

<p>В <span class="blue">SAGA GIS</span> аналогичная задача решается с использованием инструмента <span class="blackbold">Add Grid Values to Points|Добавить Значения Грида в Точки</span> группы <span class="monospace">Shape-Grid-Tools</span> набора <span class="monospace">Shapes</span>. Результат расчета  добавляется в виде нового поля к таблице шейпа точек. Однако большие возможности предоставляет другой инструмент <span class="blue">SAGA GIS</span> для векторных точек  <span class="blackbold">Grid Statistics for Points|Статистика Грида в Точки</span> набора <span class="monospace">Shape-Grid-Tools</span>, позволяющий рассчитать полный набор из восьми статистик.</p>
<br>
<img src="Pict_2_7/317_points_greed_saga.png" width="300", height="300">
<br>
<br>
<span class="imgtitle">Рис. 7.12 Окно Карты (Map) SAGA GIS с растром абсолютных высот и векторным слоем центроидов административных районов "Старой" Москвы</span> 

<br>
<img src="Pict_2_7/318_grid_statistics_for_points.png" width="35%", height="relative">
<br>
<span class="imgtitle">Рис. 7.13 Диалоговое окно инструмента Grid Statistics for Points SAGA GIS</span>
<br>
<br>

<h3 id="h3_5"><h3>7.5. Инструменты извлечения данных растровых "мозаик"</h3>


<p><b>Дисперсное "поле" ко Многим</b>: <span class="bolditalic">ИД - атрибутированный номинальный бинарный растр (0,1), ОТЕ - полигональный вектор</span>.  Зачастую пространственные данные представляют собой прерывистое, несплошное поле, т.е., являются «дискретными». Таковы, например, данные, характеризующие «распаханность» (сельскохозяйственные угодья – это отдельные ареалы на «вмещающем» общем фоне территории с другими видами землепользования),  «лесистость» (лес редко покрывает собой всю территорию без разрывов), «заозеренность» (озера разбросаны по территории «тут и там»), или «застроенность/запечатанность» городских  кварталов.  <span class="bolditalic">Важным общим свойством таких данных является то обстоятельство, что они отражают единственный признак (свойство) либо через число пикселей (растровый слой), либо через <span class="bolditalic">геометрию векторных примитивов</span> (полигонов с площадью и периметром разной длины), либо через <span class="bolditalic">общее число объектов</span> (точечный векторный слой через суммарное количество точек)</span>. В подобных случаях мы определяем «распаханность в целом», никак не разделяя это свойство на виды сельхозкультур, лесистость относительно «лесов вообще», не интересуясь при этом долей хвойных и лиственных лесов, или совокупную запечатанность - не дифференцируя на застроенность жилыми домами, промышленными зданиями и сооружениями.</p>

<p>Извлечение таких данных в сетки ОТЕ – едва ли на самая распространенная (можно сказать – «рутинная») операция в геоэкологических исследованиях разной тематики. Однако эта «рутина» имеет свои особенности для растровых и векторных исходных данных. Растровые данные подобного типа обычно несут только два значения:</p>
<span class="monospace">
True/False,<br>
1/0,<br>
1/No Data<br>
</span>
<p>При любом из вариантов записи первое значение означает наличие «сущности», а второе – ее отсутствие. Пример данных такого типа - растры древесного покрова (<a href="http://earthenginepartners.appspot.com/science-2013-global-forest/download_v1.2.html">Tree canopy cover</a>) университета Мэриленда  США, часто используемые для "валовых" оценок озелененности урбанизированных территорий, а также утрат и «приобретений» его отдельных фрагментов за фиксированные промежутки времени.</p>

<p>В <span class="red">ArcMAP10.x</span> для извлечения данных дисперсных "полей" в сетку ОТЕ обычно используется инструмент <span class="blackbold">Tabulate Area</span> набора <span class="monospace">Zonal </span>  группы <span class="monospace">Spatial</span>. На входе утилиты - дискретный растр (в иллюстрируемом здесь случае - растительный покров с бинарными значениями 1,0) и матрица полигонов ОТЕ, на выходе – таблица с суммарным количеством пикселей растра в каждом районе (величина, которая может быть пересчитана в абсолютные единицы площади, поскольку абсолютный размер пикселя всегда известен). Таблица может быть присоединена к шейпу районов по идентификатору поля <span class="cursive">Zones</span> (в данном случае <span class="cursive">FID</span>).</p>
<br>
<img src="Pict_2_7/319_tabulate_area_arc.png" width="65%" height="relative">
<br>
<span class="imgtitle">Рис. 7.14 Диалоговое окно инструмента Tabulate Area ArcMAP10.x
<br>

<p>Следует отметить, что <span class="blackbold">Tabulate Area</span> – полезный и часто используемый  инструмент <span class="red">ArcMAP10.x</span>, единственным недостатком которого является выходной «табличный» формат, поэтому чтобы не присоединять вручную каждый раз результаты, а сразу же получать шейп с новым полем, имеет смысл составить простенькую модель в <span class="blackbold">Model Builder</span>, в которой кроме собственно  <span class="blackbold">Tabulate Area</span>  будет задействован инструмент <span class="blackbold">Join Field|Добавить соединение</span> группы <span class="monospace">Join</span> набора <span class="monospace">Data Management Tools</span>.</p>
<br>
<img src="Pict_2_7/320_tab_area_jioin_model.png" width="65%" height="relative">
<br>
<span class="imgtitle">Рис. 7.15 Схема модели Model Builder с расчетом площадей по векторной сетке и присоединением таблицы к исходному шейпу полигонов ОТЕ</span></p>
<br>

<p>В <span class="blue">SAGA GIS</span> для решения аналогичной задачи используется уже знакомый нам инструмент <span class="blackbold">Grid Statistics for Polygons</span>, но в качестве  статистики в данном случае имеет смысл рассчитывать только  <span class="cursive">Summ|Сумма</span>.</p>
<br>
<img src="Pict_2_7/321_saga_grid_stat_polygon_map.png" width="300", height="300">
<br><span class="imgtitle">Рис. 7.16 Окно Карты (Map) SAGA GIS с наложением полигонального слоя районов "Старой" Москвы (ОТЕ) на дискретный растровый слой древесного покрова 

<br>
<img src="Pict_2_7/322_saga_grid_stat_polygon_dialog.png" width="35%", height="relative">
<br><span class="imgtitle">Рис. 7.17 Диалоговое окно инструмента Grid Statistics for Polygons с опцией расчета <i>Summ </i>
<br>

 <p>В результате операции у шейпа полигонов ОТЕ появится новое поле, название которому дает пользователь, например - <span class="cursive">Veget_SUMM</span></span>. Не забываем, что в <span class="blue">SAGA GIS</span> необходимо сохранить результат, нажав на иконку сохранения <span class="monospace">Save Project</span>  панели управления.</p>
 

<p><b>Мозаика или Многое ко Многим</b>: <span class="bolditalic">ИД "мозаика" - классифицированный растр со многими классами, ОТЕ - вектор полигонов</span>. Немного усложняем нашу задачу: пусть растр содержит не два (1,0), а большее число классов. Отметим, что в растр может быть и дискретным (т.е., может содержать разрывы в данных - ареалы <span class="cursive">No Data</span>) и сплошным (т.е., перекрывать всю территорию исследования): относительно применяемых инструментов извлечения это не имеет значения. В качестве примера возьмем растр геоморфологических условий Москвы, содержащий девять обобщенных типов рельефа. Предположим, что нам необходимо знать соотношение площадей разных типов в пределах каждого района города.</p>
<br>

<div class="script_01">
<figure>
<a id="323_relief_type_moscow"><img src="Pict_2_7/323_relief_type_moscow.png" width="100%" height="relative"></a>
</figure>
<figure>
<a id="323_relief_type_moscow_legende"><img src="Pict_2_7/323_relief_type_moscow_legende.png" width="60%" height="relative"></a>
</figure>
</div><br>
<br><span class="imgtitle">Рис. 7.18  Классифицированный растр типов рельефа Москвы (слева) и легенда (справа)</span></p>


<p>В <span class="red">ArcMAP10.x</span> запускаем инструмент <span class="blackbold">Tabulate Area</span> набора <span class="monospace">Zonal</span>. В отличии от предыдущего кейса, когда растр был «простым» (т.е., содержал только один класс «зеленки»), в данном растре у нас 9 классов, следовательно необходимо указать поле, в котором «зашиты» значения – <span class="cursive">Class field</span>.</p>


<a id="324_tab_area_mozaic2png"><img src="Pict_2_7/324_tab_area_mozaic2png.png" width="60%" height="relative">
<a id="324_tab_area_mozaic"><img src="Pict_2_7/324_tab_area_mozaic.png" width="60%" height="relative">
<br>
<span class="imgtitle">Рис. 7.19 a) Поля исходного вектора ОТЕ, b) диалоговое окно Tabulate Area с выбором значения Value в качестве поля класса</span>

<p>Справка говорит нам о том, что значение может быть  <span class="cursive">Integral</span> (простое число) или  <span class="cursive">String </span>(текст), но в выходной таблице текст будет выглядеть громоздко, поэтому выбираем  поле <span class="cursive">Value</span>  растра, т.е., числа.</p>
<br>
<a id="324_tab_area_mozaic_uotput"><img src="Pict_2_7/324_tab_area_mozaic_uotput.png" width="70%" height="relative">
<br>
<span class="imgtitle">Рис. 7.20 Скриншот выходной таблицы операции Tabulate Area для мозаичного классифицированного растра; поле <span class="cursive">Value</span> содержит числовые обозначения классов геоморфологических поверхностей</span>

<p>Результат (выходная таблица) отображает <span class="monospace">сумму площадей</span> (в пикселях) каждого класса в каждом районе. Для оформления слоя таблицу необходимо присоединить к полигональному файлу районов. Заметим, что под термином «оформление» здесь скорее идет речь о серии репрезентаций – слой может быть «раскрашен» по доле любого класса форм рельефа (скажем по доле, занимаемой поймами, террасами или зандрами).</p>
<br>
<a id="324_tab_area_poimu"><img src="Pict_2_7/324_tab_area_poimu.png" width="60%" height="relative">
<br>
<span class="imgtitle">Рис. 7.21 График доли пойменных поверхностей в разных районах Москвы

<p>Итоговый файл с присоединенной таблицей может использоваться как источник для построения аналитических графиков: <span class="monospace">View >> Graphs >> Create Graph</span>. Можно, например, выяснить какую долю занимает тот или иной тип геоморфологической поверхности во всех районах Москвы <a href="#324_tab_area_poimu">(Рис. 7.21)</a>, или определить долю разных форм рельефа в пределах любого отдельного района <a href="#Pict_2_7/324_tab_area_20_region.png">(Рис. 7. 22)</a>.</p> 
<br>

<a id="324_tab_area_20_region"><img src="Pict_2_7/324_tab_area_20_region.png" width="60%" height="relative">
<br><span class="imgtitle">Рис. 7.22 График доли разных типов геоморфологических поверхностей в пределах отдельного района </span>

<P>В <span class="blue">SAGA GIS</span> для извлечения значений из классифицированного растра с многими значениями классов используется инструмент <span class="blackbold">Grid Classes Area for Polygons|Площадь Классов Грида в Полигоны</span> из того же набора <span class="monospace">Shapes-Grid tools</span> группы <span class="monospace">Shapes</span>.</p> 
<a id=""><img src="Pict_2_7/326_grid_classes_area_for_polygons.png" width="35%", height="relative"> <br><span class="imgtitle">Рис. 7.23  Диалоговое окно инструмента Grid Classes Area for Polygons SAGA GIS</span>
<br>
<p>Здесь важны опции и прежде всего <span class="cursive">Class Definition (Определитель Класса)</span> (в нашем случае это <span class="cursive">Value</span>, простые числа) и вид результата – его можно получить в процентах доли каждой формы рельефа в каждом районе, что значительно более информативно для целей последующей классификации районов. В <span class="blue">SAGA GIS</span> результат может быть добавлен в виде новых полей к существующему шейпу ОТЕ или сформирован как новый  отдельный новый файл, который в этом случае надо будет сохранять под выбранными именем.</p>

<a id="326_grid_classes_area_for_polygons_saga_table"><img src="Pict_2_7/326_grid_classes_area_for_polygons_saga_table.png" width="70%" height="relative"> <br><span class="imgtitle">Рис. 7.24 Скриншот таблицы Attributes выходного файла Grid Classes Area for Polygons SAGA GIS</span>
<br>

<p>Таким образом, в таблице файла появилось девять новых полей, относящихся к исследуемому  признаку: в каждой строке, т.е., для каждого района отображается процент присутствия различных типов геоморфологических поверхностей.</p>
<br>


<h3 id="h3_6"><h3>7.6. Инструменты извлечения дисперсных векторных данных</h3>


<p><b>Мозаика или Многое ко Многим</b>: <span class="bolditalic">ИД "мозаика" - классифицированный векторный файл со многими классами, ОТЕ - вектор полигонов</span>.  Разумеется, исходные (изучаемые данные) могут быть и в векторной форме: таковы, например, полигоны LandUse/LandCover, линии автодорог  разного класса, или торговые точки принадлежащие разным ритейлерам. Для извлечения таких данных в сетку Операционно-Территориальных Единиц используются уже другие инструменты (как в <span class="blue">SAGA GIS</span>, так и в <span class="red">ArcMAP10.x</span>).


<p><span class="bolditalic">Исходные данные точечный вектор с гомогенной атрибутикой, ОТЕ - векторные полигоны</span>. В качестве примера посмотрим, как учесть число «интересных» точек по сетке районов. Точки – площадки для выгула собак в Москве. Таблица содержит информацию о площади площадок в га. Предположим, что требуется подсчитать число площадок в каждом районе и общую площадь площадок по району.</p>
<br>

<a id="329_poi_points_dog"><img src="Pict_2_7/329_poi_points_dog.png" width="50%" height="relative"> <br><span class="imgtitle">Рис. 7.25 Общий вид оверлея точечных данных и полигональной матрицы  районов "Старой" Москвы в ArcMAP10.x</span>

<p>В <span class="red">ArcMAP10.x</span> есть несколько способов, приводящих к одинаковому результату. Первый способ - инструмент <span class="blackbold">Tabulate Intersection</span> набора <span class="monospace">Statistic</span> группы <span class="monospace">Analysis Tools</span>, который позволяет получить таблицу с числом интересующих объектов <span class="cursive">N</span> и суммой площадей <span class="cursive">Summ</span> (если они включены в качестве полей в атрибуты точек); таблицу придется присоединять к шейпу полигонов ОТЕ по универсальному идентификатору районов.</p>
<br>

<div class="script">
<strong>Tabulate Intersection</strong> <br>   
Input Zone Features: ... Old_Moscow_reg <br>
Zone Fields: FID <br>
Input Class Features: ... Dog_Park_Points <br>
Out Table: Dog_Park_Values <br>
Class Field: leave blanc (* оставляем пустым, принимая, что все парки принадлежат к одному типу) <br>
Sum Fields: S (* суммируется площадь площадок) <br>
</div>

<p>После присоединения выходной таблицы к полигонам районов можно оформить слой с отображением площади "парков" для выгула собак. Чтобы не присоединять всякий раз таблицы пересечения вручную готовим простую модель, связывающую два инструмента <span class="blackbold">Tabulate Intersection</span> и <span class="blackbold">Join Field</span> пользуясь модулем <span class="monospace">Model Biulder</span>.</p>

<p>Два других способа обобщить результат пересечения таблиц относительно "зон" (операционно-территориальных единиц) входного файла в <span class="red">ArcMAP10.x</span> это инструмент <span class="blackbold">Dissolve</span> стандартного набора <span class="monospace">Geoprocessing</span> и инструмент  <span class="blackbold">Pivot Table</span>.</p>

<p>В алгоритме <span class="blackbold">Dissolve|Слияние по атрибуту</span>  шейп-файл (результат процедуры пересечения) подается на вход с указанием в качестве <span class="cursive">Dissolve_Field(s)|Поле Слияния </span> уникального идентификатора зон, в поле <span class="cursive">Statistics Field(s)</span> указываются статистические операции (в данном случае - это сумма площадей, можно также подсчитать среднюю, минимальную и максимальную площади).</p>

<p>Руководства по <span class="red">ArcMAP10.x</span> рекомендуют обобщать результаты <span class="blackbold">Tabulate Intersection</span> с помощью утилиты <span class="blackbold">Pivot Table|Сводная таблица</span>. Соответственно на вход подается таблица<span class="backgreen"> Tabulate Intersection Output Table</span>, в качестве входного поля <span class="cursive">Input Field</span>указываем уникальный идентификатор (в данном случае номер района Москвы), поле учета <span class="cursive">Pivot Field</span> - площадь участков для выгула. Далее в позиции <span class="cursive">Value Field|Поле Переменной</span> можно отметить необходимые статистические переменные. Таким образом оба инструмента приведут к одинаковым результатам, но в обоих случаях удобнее составить простейший скрипт <span class="monospace">Model Builder</span> для объединения алгоритма <span class="blackbold">Tabulate Intersection</span> с алгоритмом <span class="blackbold">Dissolve</span> или алгоритмом <span class="blackbold">Pivot Table</span>.</p>

<p><span class="blue">SAGA GIS</span> предлагает инструмент <span class="blackbold">Point Statistics for Polygons|Статистика Точек в Полигоны</span> в наборе <span class="monospace">Shapes</span> группа <span class="monospace">Polygons</span> выглядит более интересно, поскольку позволяет считать не только объекты (т.е., "парки" для выгула собак) и суммы их площадей, но также и статистики – можно например вычислить средний размер площадки для выгула по каждому району.</p>

<table id="customers">
      <table border="0">
        <tr>
    <td><a id="331_saga_point_statt_for_polyg_intrfce"><img src="Pict_2_7/331_saga_point_statt_for_polyg_intrfce.png" width="180" height="200"></a></td>
    <td><a id="331_saga_point_statt_for_polyg_itable"><img src="Pict_2_7/331_saga_point_statt_for_polyg_itable.png" width="180" height="200"></a></td>
            
        </tr>
</table>


<br><span class="imgtitle">Рис. 7.26 Диалоговое окно инструмента Point Statistics for Polygons (слева) SAGA GIS  и фрагмент таблицы слоя ОТЕ: N - индивидуальные номера районов с добавленными значениями числа площадок NUM, суммарной площади SUM и средней площади в каждом районе (справа)</span>

<p>Результат – на выбор (как практически во всех инструментах <span class="blue">SAGA GIS</span>) - либо новый шейп и таблица <span class="backgreen">Statistic</span>, либо новые поля, добавляемые к исходному файлу полигонов ОТЕ; таким образом, не требуется больше никаких действий для отображение исследуемого признака.</p>

<p><span class="bolditalic">Исходные данные  вектор полилиний с гомогенной атрибутикой, ОТЕ - вектор полигонов</span>. Многие объекты внешнего мира представлены в ГИС как полилинии: таковы авто- и железные дороги, различного рода инженерные сети, малые и средние реки. Соответственно может возникнуть потребность выявить плотность такого рода объектов по сетке операционно-территориальных единиц, например – плотность эрозионной сети или плотность автодорог в районах города.</p>

<p>В <span class="red">ArcMAP10.x</span> используем все тот же инструмент <span class="blackbold">Tabulate Intersection</span>. Программа "понимает" тип и размерность геометрического примитива и в данном случае считает суммарную длину отрезков автодорог. На выходе - таблица районов с суммой длин всех отрезков дорог в появившемся поле <span class="cursive">LENGTH</span>, для каждого конкретного района. Таблица присоединяется к шейпу районов по полю <span class="cursive">FID</span>, после чего можно оформить слой «плотность дорог» в районах Москвы.</p>
<br>

<table id="customers">
      <table border="0">
        <tr>
    <td><a id="332_arc_road_map"><img src="Pict_2_7/332_arc_road_map.png" width="270" height="330"></a></td>
    <td><a id="332_arc_road_map_intersct"><img src="Pict_2_7/332_arc_road_map_intersct.png" width="270" height="330"></td>
            
        </tr>
</table>


<br><span class="imgtitle">Рис. 7.27 a) Общий вид оверлея слоя автодорог (полилинии) и полигонального вектора ОТЕ - районов Москвы, b) оформленный слой суммарной длины автодорог в районах "Старой" Москвы 

<p>В <span class="blue">SAGA GIS</span> оверлей и извлечение данных из полилинейного слоя в полигональный осуществляется инструментом <span class="blackbold">Line-Polygon Intersection</span> набора <span class="monospace">Lines</span> группы <span class="monospace">Shapes</span>. На входе - файл полилиний дорог и полигональный векторный файл ОТЕ, на выходе - два файла полилиний: <span class="backgreen">Highway Intersection: Intersect</span>  и <span class="backgreen">Highway Difference: Intersect</span>. Интерес представляет первый, поскольку именно он содержит рассеченные границами районами отрезки дорог. Сумма по району может быть рассчитана утилитой <span class="blackbold">Line Dissolve</span> этой же группы <span class="monospace">(Lines)</span>. В поле <span class="cursive">Dissolve Fild</span> указывается наименование района <span class="greencursiv">NAME</span>, в поле <span class="cursive">Statistic Field</span> - <span class="greencursiv">L</span> (длина отрезов), в выпадающем списке статистик - <span class="greencursiv">Sum </span>(сумма). Наконец, придется еще присоединять таблицу полилинейного слоя к полигонам ОТЕ, так что можно констатировать, что эта процедура оверлея полигонов и полилиний в <span class="blue">SAGA GIS</span> пока не слишком удобна.</p>
<br>


<h3 id="h3_7"><h3>7.7. Инструменты извлечения данных векторных "мозаик"</h3>


<p><b>Дисперсное поле ко Многим</b>: <span class="bolditalic">Исходные данные  вектор полигонов с гомогенной атрибутикой,  ОТЕ - полигоны</span>. К гомогенным полигонам относятся полигональные объекты, не разделенные как «классы» и различающиеся только размерностью – площадью., периметром и формой. Типичный пример таких объектов - здания и сооружения полигонального слоя <span class="backgreen">building</span> карт <span class="monospace">Open Street Map</span>. Данные такого рода позволяют решать стандартную задачу геоэкологической оценки городской среды – определяем застроенность ("запечатанность") районов Москвы.</p>

<p>Инструмент <span class="red">ArcMAP10.x</span> <span class="blackbold">Tabulate Intersection</span> выдает таблицу с полем площади <span class="cursive">AREA</span> (в метрах) и процентом перекрытия зданиями и сооружениями территории районов - поле <span class="cursive">PERCENTAGE</span>.

<p>Далее необходимо рассчитать <span class="blackbold">Summary Statistics|Суммарную статистику</span> указав в качестве <span class="cursive">Case field</span>  поле универсального идентификатора <span class="cursive">FID</span> полигонов-кварталов, а в <span class="cursive">Statistics Field(s)|Поле статистики</span> поле площади зданий <span class="cursive">Area</span> и поле <span class="cursive">Percentage|Процентное соотношение</span>. Скрипт просуммирует площадь всех оснований зданий по каждому кварталу и долю в процентах, т.е., по сути - "запечатанность" квартала.</p>

<p>Присоединив таблицу <span class="monospace">Суммарной Статистики</span> (обычным образом - через  <span class="blackbold">Join</span> или с помощью специального инструмента <span class="blackbold">Join Fields</span>) получаем возможность построить по слою ОТЕ карту запечатанности районов.</p>


<table id="customers">
      <table border="0">
        <tr>
    <td><a id="334_building_reg_arcmap"><img src="Pict_2_7/334_building_reg_arcmap.png" width="270" height="330"></a></td>
    <td><a id="334_building_reg_arcmap_prcntge"><img src="Pict_2_7/334_building_reg_arcmap_prcntge.png" width="270" height="330"></a></td>
            
        </tr>
</table>

<br><span class="imgtitle">Рис. 7.28 a) Общий вид оверлея полигональных слоев - слой зданий и сооружений и слой административных районов, b) итоговый слой запечатанности административных районов "Старой"  Москвы<br>

<p>Поскольку подобного рода наложение представляет собой одну из самых рутинных операций в разнообразных геоэкологических оценках (например, расчеты озелененности городских кварталов, заболоченности или заозеренности речных бассейнов, распаханности территорий сельских поселений и т.д.) имеет смысл использовать несложную модель <span class="blackbold">Model Builder</span>, объединяющую три процедуры (<span class="monospace">Tabulate Intersection, Summary Statistic, Joint</span>) в один общий скрипт.</p>

<img src="Pict_2_7/330_tabulate _intersection_model_biulder.png" width="80%" height="relative"><br><span class="imgtitle">7.29 Вариант модели Model Builder для пересечения слоев, когда исходные векторные данные представлены единственным классом объектов</p>
<br>

<p><b>Мозаика или Многое ко Многим:</b> <span class="bolditalic">Исходные данные  вектор полигонов c номинальными классами, ОТЕ -вектор-полигоны</span>. Предположим, что у нас есть слой <span class="backgreen">Landuse|Виды землепользования</span> из обычного одноименного слоя полигонов набора <span class="monospace">Open Street Map</span>. Необходимо выяснить  долю, которые занимают земли различного назначения в пределах каждого района. 
<br>

<div class="script_01">
<figure>
<a id="335_landuse_arcmap"><img src="Pict_2_7/335_landuse_arcmap.png" width="115%" height="relative">
</figure>
<figure>
<a id="335_landuse_arcmap_leg"><img src="Pict_2_7/335_landuse_arcmap_leg.png" width="47%" height="relative">
</figure>
</div><br>
<span class="imgtitle">Рис. 7.30 Общий вид оверлея полигональных слоев сетки АТД Москвы и слоя Landuse OSM, источник данных - классифицированный вектор полигонов 
<br>
 
<p>В <span class="red">ArcMAP10.x</span> инструмент все тот же <span class="blackbold">Tabulate Intersection</span>, но существенный момент – наличие опции <span class="cursive">Class Field</span>: необходимо отметить поле с классами, в противном случае программа просто сосчитает процент покрытия всеми видами землепользования в районе.  Поле класса в таблице <span class="backgreen">Землепользование</span> - <span class="cursive">LandUse</span>. Иным будет и результат в выходной таблице для каждого района (мы различаем их по <span class="cursive">FID</span>), в которой будут указаны все виды землепользования. Таким образом каждый район распределен по <span class="greencursiv">N-строк</span>, где <span class="greencursiv">N</span> - число видов землепользования. Но такая таблица для нас бесполезна, ибо нам нужен <b>спектр</b> видов землепользования в каждом районе.</p>
<br>

<div class="script_01">
<figure>
<a id="335_landuse_intersction"><img src="Pict_2_7/335_landuse_intersction.png" width="250" height="300">
</figure>
<figure>
<a id="335_landuse_interscti_table_"><img src="Pict_2_7/335_landuse_interscti_table_.png" width="250" height="300">
</figure>
</div><br>
 
<span class="imgtitle">Рис. 7.31 a) Диалоговое окно инструмента Tabulate Intersection с отмеченным полем Class, b) выходная таблица Tabulate Intersection  с полями FID (номера районов) LANDUSE, AREA и PERCENTAGE
<br>

<p>Следующий шаг - сбор значений по каждому району инструментом <span class="red">ArcMAP10.x</span> <span class="blackbold">Summary Statistic</span>. Для облегчения "рутинных" сторон процедуры целесообразно использовать модель, построенная в <span class="monospace">Model Builder</span>.</p>

<p>Другой простой  и надежный способ - собрать значения в <span class="monospace">Excel</span>, используя возможности <span class="blackbold">Сводной Таблицы</span>. Данная процедура включает следующую последовательность действий  <a href="#335_excel_table_svod">(Рис. 7.32)</a>:</p>

<ul><li>Конвертация таблицы Intersction в формат Excel - <span class="backbold">Conversion Tools >> Excel >> Table to Excel</span>,</li>
    <li>Загрузка сконвертированной таблицы в <span class="backbold">Excel</span>;</li>
    <li>Использование приема <span class="backbold">Сводная таблица</span>, для расчета суммы площадей по каждому вида землепользования в пределах каждого отдельного района;</li>
    <li>Корректировка <span class="backbold">Сводной таблица</span> в <span class="backbold">Excel</span> (ликвидация лишних полей названия таблицы и приведение к виду, когда таблица помимо расчетных данных содержит только название строк и столбцов);</li>
    <li>Экспорт обратно в формат таблиц ArcMAP - <span class="backbold">Conversion Tools >> Excel >> Excel to Table</span>; </li>
    <li>Присоединение к шейпу районов <span class="backbold">Join Fields</span> (ОТЕ).</li>
</ul>
<a id="335_excel_table_svod"><img src="Pict_2_7/335_excel_table_svod.png" width="90%" height="relative"> 
<br><span class="imgtitle">Рис. 7.32 Использование возможностей сводных таблиц в Excel</span></p>

<p>Для получения <span class="monospace">Сводной таблицы</span> в <span class="monospace">Excel</span> переходим в диалог <span class="monospace">Вставить Сводную таблицу</span>. На открывшемся листе в поле строк перетаскиваем названия или индивидуальные номера районов <span class="cursive">FID</span>. В поле столбцов перетаскиваем <span class="greencursiv">LANDUSE</span>; в центральный большой прямоугольный блок значений перетаскиваем <span class="greencursiv">PERCENTAGE</span>. Далее копируем на новый лист <b>содержательную часть</b> таблицы так, чтобы сверху были названия видов землепользования в качестве наименования колонок, а в крайне левой колонке оставались только <span class="greencursiv">FID</span> районов. Сохраняя таблицу, запоминаем номер сводного листа именно его мы должны экспортировать обратно – в формат <span class="red">ArcMAP10.x</span>.  Перед сохранением на вкладке <span class="cursive">Параметры</span> надо убрать "галку" в позиции <span class="cursive">Общие итоги</span> – чтобы не было ненужного суммирования по строкам и столбцам. Заодно можно через <span class="cursive">формат ячейки</span> избавиться от лишних разрядов десятичных чисел. Лист-источник (Лист 1) можно удалить. Утилита <span class="blackbold">ArcMAP Excel to Table Table</span> конвертирует таблицу формата <span class="monospace">xlsx</span>  обратно  в формат <span class="monospace">dbf</span> (составную часть shape-файла).  Данная процедура достаточно «капризна» и поэтому имеет смысл учитывать некоторые детали:</p>

<ul>
<li>целесообразнее сохранять файл Excel в версии Книга Excel 97-2003<</li>
<li>в качестве конечной папка сохранения таблицы лучше использовать Geodata Base</li>
</ul>

<p>Результат преобразований (после присоединения таблицы к шейпу ОТЕ) открываем и просматриваем в <span class="red">ArcMAP10.x</span>: название видов землепользования должны быть названиями полей, поле <span class="greencursiv">FID</span> должно быть целочисленным <span class="monospace">INTEGER</span>. Теперь у нас есть возможность оформлять слой разными способами - в зависимости от задач. например, раскрашивать слой по доле заводской застройки (т.е., по значению <span class="greencursiv">industrial</span>).</p>



<table id="customers">
      <table border="0">
        <tr>
        <td><a id="336_land_use_industrial_class"><img src="Pict_2_7/336_land_use_industrial_class.png" width="270" height="330"> </td>
        <td><a id="336_land_use_residential_class"><img src="Pict_2_7/336_land_use_residential_class.png" width="270" height="330"> </td>
        </tr>
</table>
<span class="imgtitle">Рис. 7.33 Оформление слоя Землепользования по двум видам доля промышленной застройки (a) доля жилой застройки (b)</span>
<br>

<p>Как видим способ «один ко многим» в векторном варианте выглядит достаточно хлопотным и предполагает использование «стороннего софта» – программы <span class="monospace">Excel</span>. Заметим в этой связи что полученная в <span class="monospace">Excel</span> электронная таблица может сама по себе быть полезной для составления разного рода графиков и таблиц по теме исследования.</p>

<p>К сожалению, и <span class="blue">SAGA GIS</span> не предложит нам ничего более «простого». Инструмент <span class="blackbold">Intersect</span>  группа <span class="monospace">Shape</span>, набор <span class="monospace">Polygon</span> совершенно аналогичен – создает множественные строки для каждого пересечения конкретного района с данным участком <span class="greencursiv">LandUse</span>. Итоговая таблица выглядит аналогично. В дальнейшем придется сохранять файл как <span class="monospace">dbf</span>, открывать его в Excel, делать сводную таблицу и возвращать ее уже как <span class="monospace">DBF</span> в <span class="blue">SAGA GIS</span>.
</p>

<br>
            

<footer id="main-footer">Пространственный анализ в геоэкологии &copy; Е.Ю.Колбовский, 2022 </footer>
</div class="content">

</body>
</html>