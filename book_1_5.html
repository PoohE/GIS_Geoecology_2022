<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>spatial autocorrelation</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<style>
* {
  box-sizing: border-box;
}


figure {
    width: 50%; /* Ширина если надо расположить 2 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 1%; /* Поля */
   }
   figure:first-child {
    margin-left: 0; /* Убираем отступ для первого элемента */
   }

picture {
 width: 33%; /* Ширина если надо расположить 3 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 0%; /* Поля */
}
picture:first-child {
    margin-left: 0; /* Убираем отступ для первого элемента */
   }

   image {
    width: 100%; /* Ширина если надо расположить 1 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 0%; /* Поля */
   }

</style>
</head>

<div class="sidenav">

	<a href="#h1">I. ОСНОВЫ ПРОСТРАНСТВЕННОГО АНАЛИЗА</a>

	<a href="#h2">5. ПРОСТРАНСТВЕННАЯ АВТОКОРРЕЛЯЦИЯ</a>

	<a href="#h3_1">5.1. Пространственная автокорреляция</a>
	<a href="#h3_2">5.2. Глобальный Индекс Морана и Общая G-статистика</a>
	<a href="#h3_3">5.3. Пошаговая  пространственная автокорреляция</a>
	<a href="#h3_4">5.4. Анализ кластеров и выбросов</a>
	<a href="#h3_5">5.5. Анализ горячих точек</a>
	

	</div class="sidenav">

	<div class="content">

	<h1 id="h1">I. ОСНОВЫ ПРОСТРАНСТВЕННОГО АНАЛИЗА</h1>

		<h2 id="heading1">5. ПРОСТРАНСТВЕННАЯ АВТОКОРРЕЛЯЦИЯ</h2>

			<h3 id="h3_1">5.1. Пространственная автокорреляция </h3>


<p><strong>Пространственная автокорреляция</strong> — <span class="bolditalic">это степень пространственной зависимости, связи или корреляции между значением переменной пространственного объекта и значениями той же переменной соседних объектов</span>. Термины  <strong>Spatial Association|Пространственная ассоциация</strong> и <strong>Spatial Dependence|Пространственная зависимость</strong> часто используются также для отражения пространственной автокорреляции. 
Пространственная автокорреляция исследуется чтобы определить, существуют ли взаимосвязи между значениями атрибутов близлежащих местоположений и образуют ли эти значения паттерны  в пространстве.</p>

<p>По сути, <span class="monospace">пространственная автокорреляция</span> - это содержательное продолжение анализа причинно-следственных связей между зависимой переменной и предикторами, призванное  зафиксировать наличие и локализацию кластеров с высокими значениями - так называемые <strong>hot spot|горячие точки</strong>, а также отследить пространственные <strong>выбросы</strong>. Помимо этого пространственная автокорреляция - это еще и интерпретация <strong>статистической значимости результатов</strong>, используемая в том числе для оценки соответствия  масштаба анализа масштабу анализируемого  явления <a href="BIBLIO.html#Grekousis_2020">[Grekousis, 2020]</a>.</p>

<p>Таким образом, пространственная автокорреляция - это метод оценки пространственной зависимости данных, каковая может наблюдаться в соответствии с "первым законом географии" постулирующим, что объекты по соседству, как правило, имеют больше сходств и взаимодействий, чем объекты, расположенные дальше <a href="BIBLIO.html#Tobler_1970">[Tobler, 1970]</a>. Проще говоря, пространственная автокорреляция измеряет, насколько значение переменной в определенном местоположении связано со значениями той же переменной в соседних местоположениях.</p>

<p>Автокорреляция  существует, когда атрибутивная переменная пространственного набора данных коррелирует сама с собой на определенных расстояниях, называемых <strong> lags|лагами</strong>. Это означает, что местоположение влияет на значения переменной таким образом, что способствует кластеризации значений в определенных ареалах. Типичным примером положительной пространственной автокорреляции является распределение доходов внутри города, когда домохозяйства с более высокими доходами, как правило, группируются в определенных районах города, в то время бедные домохозяйства сосредотачиваются в других районах.</p>

<p>Различают два масштабных уровня пространственной автокорреляции: первый,  называемый (не слишком удачно) <strong>Global Autocorrelation|Глобальной автокорреляцией</strong>, и второй, именуемый  <strong>Local Autocorrelation|Локальной автокорреляцией</strong>.  Эти понятия не связаны жестко с размерностью и масштабом и скорее апеллируют к вышеприведенному примеру с пабами Лидса: мы можем проводить исследования в границах целого города (изучая "глобальную автокорреляцию"), а можем выбрать отдельные районы (центр, периферию) и использоваться "локальную автокорреляцию".</p>

<p>Для определения пространственной автокорреляции используются несколько диагностических показателей. Показатели, которые оценивают пространственную автокорреляцию по одному значению для всей исследуемой области и считаются глобальными мерами пространственной автокорреляции, включают:<br></p>

<span class="blackbold">Индекс I Морана,</span> <br>
<span class="blackbold">Общий Индекс G-статистики Гири</span><br> 
 
<p>Для оценки пространственной автокорреляции на локальном уровне  используются локальные показатели пространственной автокорреляции, такие как:</p>


<span class="blackbold">Локальный Индекс I Морана,</span> <br>
<span class="blackbold">Локальный Индекс G-статистики Гири</span> <br>

<p>Следует понимать, что <span class="bolditalic">пространственная корреляция не обязательно означает наличие причинно-следственной связи; она подразумевает только ассоциацию</span>.</p>


	<h3 id="h3_2">5.2. Глобальный Индекс Морана и Общая G-статистика</h3>


<p>Инструмент <span class="blackbold">Moran’s Index I|Индекс Морана</span>  вычисляет глобальную пространственную автокорреляцию, принимая во внимание одновременно и местоположения объектов, и значения атрибутов, и вычисляя среднее значение, отклонение от среднего значения и дисперсию данных <a href="BIBLIO.html#O’Sullivan_2010">[O'Sullivan, Unwin, 2010, стр. 206].</a> Результат - <span class="monospace">Точечные диаграммы Морана</span> - <span class="bolditalic">интерпретируется на основе ожидаемого значения, рассчитанного в соответствии с нулевой гипотезой об отсутствии пространственной автокорреляции ("полная пространственная случайность")</span>, и статистически оценивается с использованием <span class="monospace">P-значения</span> и <span class="monospace">Z-балла</span> - так же, как и любая другая <strong>выводимая статистика|inferential statistic</strong>.</p>

<p><strong>Ожидаемое значение</strong> - <span class="bolditalic">это значение, которое было бы получено, если бы конкретный набор данных был результатом полной пространственной случайности</span>. Поскольку ожидаемое значение рассчитывается как: <br>
<span class="monospace">
E = -1/ (n-1)<br>
где n - число пространственных объектов,</span><br>

то чем больше объектов, тем больше ожидаемое значение стремится к нулю.</p> 

<p><strong>Наблюдаемое значение</strong> индекса Морана - это значение, рассчитанное для конкретного набора данных.</p>

<p>Положительные наблюдаемые значения индекса  Морана I, заметно превышающие ожидаемое значение, указывают на кластеризацию и <strong>положительную пространственную автокорреляцию</strong> (т.е., близлежащие местоположения имеют аналогичные значения). Отрицательные наблюдаемые значения индекса Морана I, меньшие, чем ожидаемое значение, указывают на <strong>отрицательную пространственную автокорреляцию</strong> или "тренд дисперсии", что означает, что соседние местоположения имеют разные значения исследуемой переменной.  Значения, близкие к ожидаемому значению, указывают на <strong>отсутствие автокорреляции</strong>. Разница между наблюдаемыми и ожидаемыми значениями оценивается на основе <span class="monospace">Z-балла</span> и <span class="monospace">P-значения</span>. С помощью этих показателей мы оцениваем, является ли эта разница статистически значимой.</p>   

<p>Если значение <span class="monospace">P</span> велико <span class="greencursiv">(P > 0,05)</span>, результаты не являются статистически значимыми, и мы не можем отвергнуть нулевую гипотезу о том, что пространственное распределение значений является результатом полной пространственной случайности. Небольшое значение <span class="monospace">P</span> <span class="greencursiv">(P < 0,05)</span>  указывает на то, что мы можем отвергнуть нулевую гипотезу о полной пространственной случайности и принять, что пространственная автокорреляция существует. В этом случае <span class="monospace">Z-значение</span> позволяет оценить характер пространственной автокорреляции: при положительном <span class="monospace">Z-значении</span>  наблюдается положительная пространственная автокорреляция и расположенные рядом точки будут иметь сходные отклонения от среднего значения (либо высокие, либо низкие). Если <span class="monospace">Z-значение</span>  отрицательное, то имеет место отрицательная пространственная автокорреляция и рассеянный набор значений, в котором близлежащие местоположения будут иметь разные значения атрибутов на противоположных сторонах среднего значения (т.е., объект с высоким значением как бы отталкивает другие объекты с низкими значениями).</p>

<p>Хорошей иллюстрацией пространственной автокорреляции может служить обычная шахматная доска и различные варианты ее раскраски <a href="BIBLIO.html#Grekousis2020">[Grekousis, 2020]</a>. В идеально распределенном паттерне шахматной доски клетки расположены таким образом, что у каждой из них есть соседи противоположного цвета (черные  у белой клетки и белые  у черной клетки). <span class="monospace">Индекс Морана</span> для шахматной доски получает отрицательное (меньшее, чем ожидаемое) значение, и свидетельствует о наличии <strong>отрицательной пространственной автокорреляции</strong>. <strong>Положительная пространственная автокорреляция</strong> будет наблюдаться если мы "разведем" черные и белые клетки шахматной доски по противоположным углам, разделив их воображаемой диагональю: в этом случае у нас будет два выраженных кластера (угол черных клеток и угол белых клеток), а <span class="monospace">Индекс Морана</span> получит положительное, значительно больше  ожидаемого значение. Другие варианта размещения черных и белых клеток на доске (т.е., не "классическое" и не кластерное) будут давать значения <span class="monospace">Индекса Морана</span> близкие к нулю и таким образом фиксировать обстоятельство <strong>случайного распределения</strong>.</p>

<p>Рассчитаем  в <span class="red">ArcMAP10.x</span> глобальную пространственную автокорреляцию некоторых показателей нашей модели (преступности, заболеваемости и доходов) по полигональному файлу кварталов Нью-Йорка <span class="backgreen"> NYCTRACTs</span>, используя <span class="blackbold">Global Moran's I</span>:</p>

<div class="script">
ArcToolBox >> Spatial Statistics Tools >> Analyzing Patterns >> Spatial Autocorrelation (Moran’s I)<br>
Input Feature Class: NYCTRACTs<br>
Input Field: Murdr_15y<br>
Generate Report: Check the box<br>
Conceptualization of Spatial Relationships = INVERSE_DISTANCE<br>
Distance: EUCLIDEAN_DISTANCE<br>
Standardization: ROW  (*Пространственные веса СТРОК стандартизированы, каждый вес делится на сумму строк - сумму весов всех соседних объектов)<br>
Distance Band or Threshold Distance|Диапазон расстояний или Пороговое расстояние: оставляем пустым
</div>

<p>Показатели пространственной автокорреляции доступны в <span class="monospace"> Results (Main Menu >> Geoprocessing >> Results >> Current Session >> Spatial Autocorrelation) = C:\Users\ArcGIS\MoransI_Result1.html</span>, где кроме показателей <span class="monospace">Z-оценки</span> и <span class="monospace">P-значения</span> доступны график а также "сообщение":</p> 

<span class="monospace">
Given the z-score of 76.7040522927, there is a less than 1% likelihood that this clustered pattern could be the result of random chance. <br>

Moran's Index:	0,342806<br>
Expected Index: -0,000475<br>
Variance: 0,000020<br>
z-score:	76,704052<br>
p-value:	0,000000<br>
Distance Threshold:	10079,9475 US_Feet<br>
</span>

<br>
<a id="MoranGlobПреступн"><img src="Pict_1_5/MoranGlobПреступн.png" width="60%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.1 График Отчета Spatial Autocorrelation|Анализа  пространственной автокорреляции Морана для переменной Число убийств в кварталах Нью-Йорка<br>

<p>Для сравнения рассчитаем <span class="blackbold">Глобальный индекс Морана</span>  для другой переменной - <strong>Доходов домохозяйств Нью-Йорка</strong>.</p>

<span class="monospace">

Moran's Index:	0,487167<br>
Expected Index: -0,000475<br>
Variance: 0,000020<br>
z-score:	108,932727<br>
p-value:	0,000000<br>
Distance Threshold:	10079,9475 US_Feet<br>
<br></span>

<p>Мы видим, что <span class="monospace">Индекс Морана</span> значительно превышает ожидаемое значение <span class="greencursiv">0,342806</span> против <span class="greencursiv">-0,000475</span>, что указывает на кластеризацию и положительную пространственную автокорреляцию (т.е., расположенные по соседству кварталы будут иметь близкие значения преступности). Принимая во внимание крайне высокое значение <span class="monospace">Z-оценки</span> <span class="greencursiv">76,704052</span> и нулевое  <span class="monospace">P-значение</span> мы можем констатировать что кластерное распределение изучаемого явления закономерно; дополнительное подтверждение -  график html-отчета <a href="#MoranGlobДоходд">(Рис. 5.2)</a>.  </p>


<a id="MoranGlobДоходд"><img src="Pict_1_5/MoranGlobДоходд.png" width="60%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.2 График Отчета Spatial Autocorrelation  анализа  Пространственной Автокорреляции Морана для переменной "Доход домохозяйств" в кварталах Нью-Йорка<br>

<p>Кластерность и "неслучайность" распределения  <b>Дохода домохозяйств по кварталам</b> Нью-Йорка также не подлежит сомнению, поскольку мы имеем еще большее превышение <span class="monospace">Индекса Морана</span> над ожидаемым значением <span class="greencursiv">0,487167</span> против <span class="greencursiv"><-0,000475</span>) и еще более высокий <span class="monospace">Z-балл</span> <span class="greencursiv">108,9</span>. Обратим внимание на то обстоятельство, что поскольку в обоих случаях расчет <span class="monospace">Глобального индекса Морана</span> велся по одной и той же сетке,  мы получили и одинаковую величину <span class="monospace"> Distance Threshold|Порогового значения</span> - <span class="greencursiv">10079,9475 US_Feet</span>, составляющую чуть более 3 км (<span class="greencursiv">3072 м</span>).</p>

<p>Итак, <span class="blackbold">Глобальный индекс Морана</span> - <span class="bolditalic">надежный алгоритм, позволяющий принять или опровергнуть "нулевую гипотезу" о пространственной автокорреляции для множества точек и любой сети операционно-территориальных единиц</span> (полигонов, нагруженных разными переменными), и, таким образом, выявить неслучайное кластерной или дисперсное поведение исследуемого феномена. Заметим, что <span class="monospace">Индекс Морана</span> <span class="bolditalic">может свидетельствовать о наличии кластеризации явления, но он не отличает кластеров высоких значений от кластеров низких значения</span>. Для разделения таких кластеров используется <span class="blackbold">Общий индекс Getis-Ord G</span>  - еще один статистический индекс, позволяющий обнаружить кластеры низких значений ("холодные точки") или высоких значений ("горячие точки") и являющийся показателем пространственной взаимосвязи <a href="BIBLIO.html#Ord_Getis_1995">[Ord, Getis, 1995]</a>.</p>

<p><span class="blackbold">Общий G-Индекс</span> <span class="bolditalic">используется для ответа на вопрос о том, вызвана ли обнаруженная автокорреляция кластеризацией высоких значений или кластеризацией низких значений</span>. Значения <span class="blackbold">G-Индекса</span> варьируется от <span class="greencursiv">0</span> до <span class="greencursiv">2</span>: при этом значение <span class="greencursiv">1</span> обычно указывает на отсутствие пространственной автокорреляции. Значения, значительно меньшие <span class="greencursiv">1</span>, указывают на положительную пространственную автокорреляцию, в то время как значения, значительно большие <span class="greencursiv">1</span>, указывают на отрицательную пространственную автокорреляцию <a href="BIBLIO.html#O’Sullivan_2010">[O’Sullivan, Unwin, 2010]</a>. Как и в случае с <span class="blackbold">Индексом Морана</span> результаты <span class="blackbold">G-Индекса</span>  интерпретируются на основе <span class="monospace">Z-оценки</span> и <span class="monospace">P-значения</span>, которые позволяют либо принять либо отклонить  нулевую гипотезу о полной пространственной случайности.</p>

<p>Аналогичны и правила интерпретации. Когда значение <span class="monospace">P </span>невелико  <span class="greencursiv">P < 0,05</span>, нулевая гипотеза отвергается, и имеются статистически значимые доказательства кластеризации, далее:</p>

(a) Если Z-оценка положительная и наблюдаемое общее значение G-статистики больше ожидаемого, это указывает на концентрацию высоких значений (горячих точек).<br> 
(b) Если Z-оценка отрицательная и наблюдаемое общее значение G-статистики меньше, ожидаемого это указывает на то, что низкие значения (холодные пятна) сгруппированы в ареалах исследуемой области. 

<p> Рассчитаем <span class="blackbold">Getis-Ord General G-statistic</span> для преступности и дохода домохозяйств по кварталам Нью-Йорка в <span class="red">ArcMAP10.x</span>, воспользовавшись инструментом из набора <span class="monospace">Пространственная Статистика</span>, который так и называется <span class="blackbold">High/Low Clustering|Кластеры Высоких и Низких Значений</span>.</p>

<div class="script">
	ArcToolBox >> Spatial Statistics Tools >> Analyzing Patterns >>
	High/Low Clustering (Getis-Ord General G)
	Input Feature Class: NYCTRACTs<br>
	Input Field: Murdr_15y<br>
	Generate Report: Check the box<br>
	Conceptualization of Spatial Relationships: INVERSE_DISTANCE<br>
	Distance: EUCLIDEAN_DISTANCE<br>
	Standardization: ROW<br>
	Distance Band or Threshold Distance: Leave blank
</div>

<p>Доступ к результатам -как обычно через <span class="blackbold">Геообработку</span>: <span class="monospace">
Main Menu >> Geoprocessing >> Results >> Current Session >> High/Low Clustering (Getis-Ord General G)>> DC on GeneralG_Results .html:</span></p>
<span class="monospace">
Observed General G:	0,000017<br>	
Expected General G:	0,000009<br>	
Variance: 0,000000<br>	
z-score: 8,142788<br>	
p-value: 0,000000</p>
</span>
<p>Значение <span class="monospace">G-Индекса</span> в два раза больше ожидаемого при высоком положительном значении <span class="monospace">Z-оценки</span> и "доверительном" (<span class="greencursiv">< 0,05</span>) <span class="monospace">P-значении</span> свидетельствует о кластеризации "горячих" точек - вывод, подтверждаемый и Графиком, и "подсказкой":<br>
<span class="monospace">Given the z-score of 38.1427875193, there is a less than 1% likelihood that this high-clustered pattern could be the result of random chance</span>. 
Поскольку <span class="monospace">G-Индекс</span> значительно меньше единицы, следовательно можно говорить о <b>положительной пространственной автокорреляции</b>.</p>

<a id="High-Low Clustering Report"><img src="Pict_1_5/High-Low Clustering Report.png" width="60%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.3 График Отчета High-Low Clustering  анализа   для переменной Число убийств в кварталах Нью-Йорка

<p>Рассчитаем <span class="blackbold">G-Индекс</span> для <b>Дохода домохозяйств по кварталам</b> Нью-Йорка:</p>
<span class="monospace">

Observed General G:	0,000009<br>
Expected General G:	0,000009<br>
Variance:	0,000000<br>
z-score:	0,032577<br>
p-value:	0,974012 
</span>
<p>Значения ожидаемого и расчетного <span class="monospace">General G</span>  одинаковы, при этом <span class="monospace">P-значение</span> больше <span class="greencursiv">0,5</span> и <span class="monospace">Z-оценка</span> меньше <span class="greencursiv">0,05</span> - признаки рандомного распределения; в "послании" html_отчета читаем:<br>
<span class="monospace">Given the z-score of 0.032577, the pattern does not appear to be significantly different than random</span>.</p>

<a id="High-Low Clustering Report_INCOM"><img src="Pict_1_5/High-Low Clustering Report_INCOM.png" width="60%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.4 График Отчета High-Low Clustering  анализа   для переменной Доход домохозяйств в кварталах Нью-Йорка<br>

<p>Следовательно, несмотря на наличие "кластерности", выявленное с помощью <span class="monospace">Индекса Морана</span>, скопления высоких значений (<b>горячих точек</b>) не обнаруживают пространственной закономерности - они случайны.</p><br>


<h3 id="h3_3">5.3. Пошаговая  пространственная автокорреляция</h3>


<p><span class="blackbold">Пошаговая  пространственная автокорреляция|Incremental Spatial Autocorrelation</span> - метод, основанный на индексе <span class="blackbold">Global Moran's I</span> для проверки наличия пространственной автокорреляции в диапазоне расстояний, позволяющий выявить <strong>шаг изменчивости признака в пространстве</strong>. Вместо произвольного выбора дистанций этот метод определяет соответствующий фиксированный диапазон расстояний, для которого пространственная автокорреляция более выражена. Другими словами, <span class="bolditalic">алгоритм  определяет самое дальнее расстояние, на котором объект все еще оказывает значительное влияние на другой</span>. После установления соответствующей шкалы анализа можно более точно рассчитать локальные пространственные индексы автокорреляции и другую пространственную статистику.</p>

<p>Алгоритм <span class="blackbold">Пошаговая пространственная автокорреляция</span> измеряет автокорреляцию для ряда расстояний и при необходимости создает линейный график этих расстояний и соответствующих <span class="monospace">Z-оценок</span>. <span class="bolditalic">Статистически значимые пиковые Z-оценки указывают расстояния, на которых пространственные процессы, способствующие кластеризации, наиболее выражены</span>.</p>

<p><span class="bolditalic">Выбор подходящего масштаба анализа для выстраиваемой модели является одной из самых сложных задач в пространственном анализе</span>. Масштаб анализа определяет размер и форму районов, для которых рассчитывается пространственная статистика, и тесно связан с рассматриваемой проблемой.  Исследователи и аналитики, не имеющие глубокого понимания проблемы, часто склонны применять инструменты пространственной статистики, основанные на предопределенных значениях по умолчанию (<span class="monospace">default</span>). Между тем, некритический выбор  расстояния анализа может приводить к  некорректным оценкам и неправильным выводам</a>. Ситуация осложняется тем, что в реальном пространстве кластеризация может оказаться значимой одновременно на разных пространственных уровнях: например, на уровне кварталов и на уровне районов города. Иными словами "дьявол кроется в мелочах". По этой причине <span class="monospace">Пошаговую  пространственную автокорреляцию</span> <span class="bolditalic">рекомендуют проводить с предварительным выбором освобождением от значений-выбросов</span>. В качестве начального расстояния необходимо выбрать то, которое гарантирует, что у каждого объекта есть хотя бы один сосед <a href="BIBLIO.html#Grekousis_2020">[Grekousis, 2020]</a>.</p>


<p>Рассчитаем <span class="blackbold">Пошаговую  пространственную автокорреляцию</span> для кварталов Нью-Йорка по полю <b>Числа тяжких преступлений за 15 лет</b> (<span class="monospace">ArcToolBox >> Spatial Statistics Tools >> Analyzing Patterns >> Incremental Spatial Autocorrelation)</span>.</p>

<div class="script">
Incremental Spatial Autocorrelation<br>

Input Feature Class: NYCTRACTs<br>
Input Field: Murdr_15y<br>
Number of distance bands: 10<br>
Beginning Distance:  Leave blank<br>
Distance Increment:  Leave blank<br>
Distance:  EUCLIDEAN<br>
Row Standardization:  Check the box<br>
Output Table:  ... Increment<br>
Output Report File:  .... Increment.pdf<br>

</div>

<p> Алгоритм выводит <span class="monospace">PDF-файл отчета</span> и отдельную таблицу. По графику <span class="monospace">Distance</span> в файле отчета можно судить о "пиковом" расстоянии, на котором наблюдается кластеризация изучаемой переменной <a href="#Icremen_Spat_Stat_Murdr15">(Рис. 5.5)</a>. В данном случае - это дистанция около <span class="greencursiv">15214 футов</span> (или <span class="greencursiv">4,64 км</span>).</p>

<br>
<a id="Icremen_Spat_Stat_Murdr15"><img src="Pict_1_5/Icremen_Spat_Stat_Murdr15.png" width="70%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.5 График Пошаговой  пространственной автокорреляции для переменной Число убийств за 15 лет в кварталах Нью-Йорка
<br>

<p>По таблице <span class="monospace">PDF-отчета</span> <a href="#Icremen_Spat_Stat_Murdr15_Table">(Рис. 5.6)</a> мы можем видеть, что значению дистанции <span class="greencursiv">15214</span> соответствуют наибольшее значение <span class="monospace">Z</span> и положительный <span class="monospace">Индекс I Морана </span> <span class="greencursiv">0,224595</span>, что подтверждает сделанный ранее вывод о наличии кластеризации и положительной пространственной автокорреляции.</p>

<a id="Icremen_Spat_Stat_Murdr15_Table"><img src="Pict_1_5/Icremen_Spat_Stat_Murdr15_Table.png" width="80%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.6 Скриншот таблицы Incremental Spatial Autocorrelation  для переменной Число убийств за 15 лет в кварталах Нью-Йорка<br>


<p>Следующий шаг <strong>Анализа Пространственной автокорреляции</strong> -  <span class="blackbold">Generate Spatial Weights Matrix|Вычисление матрицы пространственных весов</span>.  <span class="monospace">Дистанция максимальной автокорреляции</span>, полученная в качестве "пикового" расстояния <span class="blackbold">Incremental Spatial Autocorrelation</span>, используется для вычисления <span class="monospace">Матрицы весов</span> таким образом, что объекты, расположенные дальше этого расстояния, не будут включены в расчет функции веса. Одновременно устанавливается минимальное число соседей, и если в пространстве порогового значения эти число не обеспечивается - дистанция увеличивается до включения установленного минимума (скажем 3 или 4 соседа).</p>

<div class="script">
ArcToolBox >> Spatial Statistics Tools >> Modeling Spatial
Relationships >> Generate Spatial Weights Matrix <br>

Input Feature Class = NYCTRACTs<br> 
Unique ID Field: FID<br>
Output Spatial Weights Matrix File: ... NYCTRACTs.swm<br>
Conceptualization of Spatial Relationships: FIXED_DISTANCE<br>
Distance Method: EUCLIDEAN<br>
Exponent: 1<br>
Threshold Distance: 15214 (как результат пошаговой пространственной автокорреляции в Incremental Spatial Autocorrelation)<br>
Number of Neighbors: 3<br>
Row Standardization: Check<br>
</div>

<p>Результирующий файл выводится в нечитаемом формате <span class="monospace">swf</span>: чтобы  отредактировать веса для каждого набора пространственных объектов, мы должны преобразовать <span class="backgreen">swf-файл</span> в таблицу с помощью функции <span class="blackbold">Convert Spatial Weights Matrix to Table|Преобразовать пространственные веса в таблицу</span>.</p><br>

<a id="WeightMatrix"><img src="Pict_1_5/WeightMatrix.png" width="35%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.7 Скриншот таблицы Пространственных Весов<br>


<p>Типичная матрица пространственных весов в <span class="red">ArcMAP10.x</span> состоит из трех столбцов:</p>
 <span class="cursive">ID </span> - уникальный идентификатор пространственного объекта, <br>
 <span class="cursive">NID</span> -  идентификатор соседнего объекта, с которым существует связь,<br>
 <span class="cursive">WEIGHT</span> - значение веса, которое количественно определяет пространственную связь.<br>

<p>По таблице <a href="#WeightMatrix">(Рис. 5.7)</a> мы можем судить, что, например, объект  (квартал с ID <span class="greencursiv">2089 </span>) связан с пятью другими объектами (кварталами) и вес этой связи <span class="greencursiv">0,2.</span> Таблица Весов не представляет самостоятельного интереса, но она используется в локальных индексах, в частности - в <span class="blackbold">Локальном индексе Морана</span>.</p>
<br>


<h3 id="h3_4">5.4. Анализ кластеров и выбросов</h3>


<p>Глобальные индексы пространственной автокорреляции определяют, есть ли кластеризация в значениях переменной, но они не указывают, где расположены кластеры. Чтобы определить местоположение и величину пространственной автокорреляции, мы должны  использовать локальные индексы, в частности <span class="blackbold"> Local Moran’s I or Cluster and Outlier Analysis|Локальный Индекс Морана или Анализ кластеров и выбросов</span>.</p>

 <p><span class="blackbold"> Локальный индекс Морана I</span> интерпретируется на основе ожидаемого значения, <span class="monospace">P-значения</span> и <span class="monospace">Z-оценки</span> в соответствии с нулевой гипотезой об отсутствии пространственной автокорреляции. При расчете <span class="monospace">Локального индекса Морана</span> используется величина <span class="monospace">Пространственного веса</span>. Как и в случае с <span class="monospace">Глобальным индексом Морана</span> положительные наблюдаемые значения <span class="monospace">Локального индекса Морана I</span>, значительно превышающие ожидаемое значение, указывают на потенциальную кластеризацию. Отрицательные наблюдаемые значения <span class="monospace">Локального индекса Морана I</span>, значительно меньшие, чем ожидаемое значение, указывают на потенциальное наличие пространственных выбросов. Значения, близкие к ожидаемому значению, указывают на отсутствие автокорреляции <a href="BIBLIO.html#Grekousis_Gialis_2018">[Grekousis, Gialis, 2018]</a>.</p>

<p>Небольшие <span class="monospace">P-значения</span> <span class="greencursiv">< 0,05</span> указывает на то, что мы можем отвергнуть гипотезу о полной пространственной случайности и признать, что пространственная автоматическая корреляция существует. В этом случае если <span class="monospace">Z-оценка</span> положительная <span class="greencursiv">> 0</span>, мы имеем положительную пространственную автокорреляцию и кластеризацию. Высокая положительная <span class="monospace">Z-оценка</span> (например, больше <span class="greencursiv">2,60</span>) для пространственной сущности означает, что образуются  <strong>кластеры High-High</strong> - пространственные сущности с высокими значениями (для конкретной переменной) окружены пространственными сущностями высоких значений (одной и той же переменной). Если <span class="monospace">Z-оценка</span> отрицательная (<span class="greencursiv">< 0</span>), наблюдается отрицательная пространственная автокорреляция, причем когда значения низкие, то образуются  <strong>кластеры Low-Low,</strong> что означает, что пространственные объекты с низкими значениями окружены пространственными объектами низких значений <a href="BIBLIO.html#Anselin_2010">[Anselin, 2010]</a>.</p>

<p>Рассчитаем <span class="blackbold">Локальный индекс Морана I</span> относительно  преступности, и доходов домохозяйств  чтобы определить, существуют ли кластеры и выбросы по данному параметру среди кварталов Нью-Йорка.</p>

<div class="script">

ArcToolBox >> Spatial Statistics Tools >> Mapping Clusters >> Cluster and Outlier Analysis <br>
Input Feature Class: NYCTRACTs <br>
Input Field: Murdr_15y (*income - для анализа по доходам) <br>
Output Feature Class: LocalMoranI_Murdr.shp <br>
Conceptualization of Spatial Relationships:
GET_SPATIAL_WEIGHTS_FROM_FILE <br>
Weights Matrix File: Tracts_Spatial_Weights <br>
Apply False Discovery Rate (FDR) Correction: Check <br>
</div>
<br>

<div class="script_01">
<figure>
<a id="Кластры_Выбросы_Преступн"><img src="Pict_1_5/Кластры_Выбросы_Преступн.png" width="100%" height="relative"></a>
</figure>
<figure>
<a id="Кластеры_Выбросы_Доходы"><img src="Pict_1_5/Кластеры_Выбросы_Доходы.png" width="100%" height="relative"></a>
</figure>
</div><br>


<span class="imgtitle">Рис. 5.8 Кластеры и Выбросы: a) для переменной Число убийств, b) Доходы домохозяйств в кварталах Нью-Йорка</p>


<p> Для интерпретации результатов полезно помнить, как расшифровываются значения пяти классов легенды картограммы <span class="monospace">LocalMoranI|Локального индекса Морана</span>, два из которых соответствуют кластерам, два - выбросам и один - фону. Продемонстрируем это на примере переменной дохода:</p> 

<span class="monospace">
<strong>Not Significant</strong> - фоновые значения, которые нельзя отнести ни к "горячим" (кварталам с высоким значением доходов домохозяйств), ни к "холодным"  (кварталам с низкими доходами);<br>
<strong>High-High Cluster</strong> (HH в таблице файла) - кластер кварталов с высокими значениями доходов, т.е., соседом каждого такого квартала является другой "высокодоходный" квартал;<br>
<strong>Low-Low Cluster</strong> (LL в таблице файла) - кластер кварталов с низкими значениями доходов, когда соседом каждого такого квартала является другой "бедный" квартал;<br>
<strong>High-Low Outlier</strong> (HL в таблице файла) - кварталы с контрастно высоким значением дохода, окруженные "бедными" кварталами;<br>
<strong>Low-High Outlier</strong> (LH  в таблице файла) - "бедные" кварталы, окруженные "богатыми" кварталами.
<br>
</span>
<p>В нашем случае выявления возможных причин распределения феномена преступности обе полученные картограммы целесообразно рассматривать в сравнении. Легко заметить, что, например, в Бруклине и Бронксе кварталы с <span class="greencursiv">Low-High</span> выбросами по числу убийств зачастую одновременно являются кварталами-выбросами <span class="greencursiv">High-Low</span> по размеру дохода домохозяйств. В тоже время большая часть кварталов <span class="greencursiv">High-High</span> кластера по доходам в Куинсе являются <span class="greencursiv">Low-Low</span> кластерами в Куинсе и Статен-Айленде.</p>

<p>В дополнении к картограммам можно анализировать таблицы создаваемого алгоритмом слоя <a href="#Кластеры_Выбросы_Доход_Table">(Рис. 5.9)</a>, где в поле <span class="backgreencursiv">COType</span> указывается, является ли объект (в нашем случае - квартал) выбросом или он принадлежит кластеру.</p>

<a id="Кластеры_Выбросы_Доход_Table"><img src="Pict_1_5/Кластеры_Выбросы_Доход_Table.png" width="50%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.9 Скриншот таблицы со значениями Локального индекса Морана для переменной Доходы домохозяйств в кварталах Нью-Йорка

<p>Таблица файла <span class="monospace">Локального индекса Морана</span> позволяет оценить не только класс распределения (<span class="cursive">кластер</span> - <span class="cursive">выброс</span> - <span class="cursive">фон</span>) но и <span class="monospace">Z-оценку</span> и <span class="monospace">P-значение</span> для любого квартала или группы кварталов, что позволяет судить о знаке автокорреляции: положительная при положительных значениях <span class="monospace">Z</span> и отрицательная - при отрицательных, соответственно статистическая значимость проверяется по <span class="monospace">P-значению</span> в той же строке.</p>
<br>


<h3 id="h3_5">5.5. Анализ горячих точек</h3>


<p> <span class="blackbold">Hot Spot Analysis|Анализ горячих точек </span> или <span class="blackbold">Getis-Ord Gi*I</span> - еще один алгоритм, который идентифицируют статистически значимые кластеры с высокими значениями (горячие точки) и кластеры с низкими значениями (холодные точки) и используются в качестве показателей пространственной взаимосвязи <a href="BIBLIO.html#Kleinschmidt et al._2016">[Kleinschmidt et all, 2016]</a>.</p>

<p>Алгоритм рассчитывает <span class="monospace">Z-оценку</span> и <span class="monospace">P-значение</span>; которые интерпретируются также, как и в других инструментах рассматриваемой группы. Наличие высокой положительной <span class="monospace">Z-оценки</span> и небольшого <span class="monospace">P-значения</span> указывает на пространственную кластеризацию высоких значений (т.е., горячую точку), тогда как наличие низкой отрицательной <span class="monospace">Z-оценки</span> с небольшим <span class="monospace">P-значением</span>  указывает на наличие холодных точек (пространственная кластеризация низких значений). В обоих случаях наблюдается <strong>положительная пространственная автокорреляция</strong>. Чем выше <span class="monospace">Z-оценка</span> (положительная или отрицательная), тем интенсивнее кластеризация<a href="BIBLIO.html#O’Sullivan_2010"> [O’Sullivan, Unwin, 2010]</a>.</p>

<p>Построим картограмму <span class="blackbold">Анализа Горячих Точек</span> последовательно для переменной преступлений и переменной дохода домохозяйств по кварталам Нью-Йорка.</p>

<div class="script">
ArcToolBox >> Spatial Statistics Tools >> Mapping Clusters >> Hot Spot Analysis
Input Feature Class: NYCTRACTs<br> 
Input Field: Murdr_15y, (*income  - для анализа Доходов домохозяйств)<br>
Output Feature Class: ... \HotSpotMurdr_15y.shp<br>
Conceptualization of Spatial Relationships :GET_SPATIAL_WEIGHTS_FROM_FILE<br>
Self Potential Filed: Leave blanc<br>
Weights Matrix File: ...\TractsWeights.swm<br>
Apply False Discovery Rate (FDR) Correction: Do not check (*статистическая значимость будет определяться P-значением и Z-оценкой)
</div>
<br>
<br>

<div class="script_01">
<figure>
<a id="HotSpot_MURDR"><img src="Pict_1_5/HotSpot_MURDR.png" width="100%" height="relative"></a>
</figure>
<figure>
<a id="HotSpot_INCOME"><img src="Pict_1_5/HotSpot_INCOME.png" width="100%" height="relative"></a>
</figure>
</div><br>

<span class="imgtitle">Рис. 5.10 Картограммы Анализа Горячих Точек в кварталах Нью-Йорка: a) для переменной Число убийств за 15 лет, b) Доходы домохозяйств 

<p>Алгоритм генерирует картограммы с семью классами:</p>
Not Significant - в этих кварталах отсутствует кластеризация по рассматриваемой переменной или признаку;<br> 
три типа кластеров "Cold Spot - холодных точек", в которых кварталы с низкими значениями окружены такими же  с последовательно понижающейся вероятностью (Confidence 99%, 95% и 90%);<br>
три типа кластеров "Hot Spot - горячих точек", в которых кварталы с высокими значениями окружены такими же с последовательно понижающейся вероятностью (Confidence 99%, 95% и 90%).<br>

<p>Сравнивая картограммы  <span class="monospace">Анализа горячих точек</span> по преступлениям и доходам домохозяйство можно констатировать их практически абсолютную (с незначительными отклонениями) противоположность: "горячие" (99%) кластеры кварталов с высоким <b>числом убийств за 15 лет</b> соответствуют "холодным" (99%) кластерам кварталов с <b>низкими доходами</b>, что, по крайней мере, отчасти, подтверждает гипотезу о социальных истоках преступности.</p>

<p>Так называемый <span class="blackbold">Optimized Hot Spot Analysis|Оптимизированный анализ горячих точек</span>  <span class="red">ArcMAP10.x</span> выполняет всю процедуру автоматизированным способом, что значительно экономит время анализа. Результаты аналогичны результатам <span class="blackbold">Hot Spot Analysis</span>. Выходное сообщение содержит информацию  о масштабе анализа (в нашем случае <span class="backgreencursiv">1157 м</span>), а также о наличии (или отсутствии) локальных выбросов.</p>

<div class="script">
ArcToolBox >> Spatial Statistics Tools >> Mapping Clusters >>  Optimized Hot Spot Analysis;<br> 
Input Feature Class = NYCTRACTs;<br> 
Input Field = Murdr_15y, (* income  - для анализа Доходов домохозяйств);<br>
Output Feature Class = ... \OptimizedHotSpotMurdr_15y.shp.<br>
</div>

<div class="script_01">
<figure>
<a id="OptimHotSpot_MURDR"><img src="Pict_1_5/OptimHotSpot_MURDR.png" width="100%" height="relative"></a>
</figure>
<figure>
<a id="OpimHotSpot_INCOME"><img src="Pict_1_5/OpimHotSpot_INCOME.png" width="100%" height="relative"></a>
</figure>
</div><br>

<span class="imgtitle">Рис. 5.11 Картограммы Оптимизированного анализа горячих точек в кварталах Нью-Йорка: a) для переменной Число убийств, b) Доходы домохозяйств 

<p>Как можно убедиться, <span class="blackbold">Оптимизированный Анализ Горячих Точек</span> демонстрирует более концентрированные и, возможно, точнее локализованные кластеры. Определенный интерес представляет и <span class="monospace"> Messages</span>, открывающийся в <span class="monospace">Результатах Геообработки</span>.</p>


<a id="OptimHotSpot_MURDR_Messeges"><img src="Pict_1_5/OptimHotSpot_MURDR_Messeges.png" width="80%" height="relative"></a><br>
<span class="imgtitle">Рис. 5.12 Скриншот сообщения Оптимизированного анализа горячих точек для переменной Число убийств за 15 лет в кварталах Нью-Йорка

<p>Сообщение оповещает нас об общем количестве валидных <span class="greencursiv">2108 кварталов</span>, включенных в анализ, обнаруженном числе выбросов <span class="greencursiv">34 outlier</span>, которые не использовались для расчета оптимальной дистанции учета соседских объектов, а также о числе таких соседств <span class="greencursiv">30 nearest neighbours</span> и диапазоне их обнаружения <span class="greencursiv">6105 футов (1861 м)</span>.</p>

<p>Таким образом, <span class="bolditalic"> инструменты Пространственной Автокорреляции позволяют не просто обнаружить обстоятельство взаимосвязи расположения объектов и ассоциации их атрибутов, но и локализовать кластеры, разделив их на "холодные" (с пониженными значениями) и "горячие" (с повышенными значениями), а также - определить характерные дистанции их формирования</span>. Все эти характеристики могут быть эффективно использованы в анализе как геоэкологических процессов (распространение и распределение загрязнений различных сред, конфигурирование ареалов заболеваемости с выявлением их центров), так и социально-экономических феноменов (величины и неравенства доходов, девиантного поведения и преступности, формирования центров разнообразных обслуживающих сетей и т.д.).</p>
<br>
<br>
			

<footer id="main-footer">Пространственный анализ в геоэкологии &copy; Е.Ю.Колбовский, 2022 </footer>
</div class="content">
</body>
</html>