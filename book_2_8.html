<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>grouping claster analysis</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<style>

* {
  box-sizing: border-box;
}

figure {
    width: 50%; /* Ширина если надо расположить 2 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 0%; /* Поля */
   }
   figure:first-child {
    margin-left: 0; /* Убираем отступ для первого элемента */
   }

picture {
 width: 33%; /* Ширина если надо расположить 3 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 0%; /* Поля */
}
picture:first-child {
    margin-left: 0; /* Убираем отступ для первого элемента */
   }

   image {
    width: 100%; /* Ширина если надо расположить 1 картинки в ряд*/
    float: left; /* Выстраиваем элементы по горизонтали */
    margin: 0 0 0 0%; /* Отступ слева */
   text-indent: 0px; /* убираем отступ для картинки как ни странно */
   /* background: #f0f0f0; /* Цвет фона */
    border-radius: 1px; /* Радиус скругления */
    padding: 10%; /* Поля */
   }

</style>
</head>

<div class="sidenav">
<a href="#h1">II. БАЗОВЫЕ ПРОЦЕДУРЫ АНАЛИЗА ДАННЫХ В ГЕОЭКОЛОГИИ</a>

<a href="#h2">8. АНАЛИЗ ГРУППИРОВАНИЯ И КЛАСТЕРИЗАЦИЯ КАК СПОСОБЫ КЛАССИФИЦИРОВАНИЯ И РАЙОНИРОВАНИЯ</a>

		<a href="#h3_1">8.1. Районирование как типология и районирование как классификация</a>
		<a href="#h3_2">8.2. Анализ группирования как способ районирования в ArcMAP</a>
		<a href="#h3_3">8.3. Кластеризация  как способ классифицирования в SAGA GIS</a>
		<a href="#h3_4">8.4. Районирование по набору разнородных признаков</a>
		
	
</div class="sidenav">

<div class="content">

<h1 id="">II. БАЗОВЫЕ ПРОЦЕДУРЫ АНАЛИЗА ДАННЫХ В ГЕОЭКОЛОГИИ</h1>

<h2 id="h2">8. АНАЛИЗ ГРУППИРОВАНИЯ И КЛАСТЕРИЗАЦИЯ КАК СПОСОБЫ КЛАССИФИЦИРОВАНИЯ И РАЙОНИРОВАНИЯ</h2>

		<h3 id="h3_1">8.1. Районирование как типология и районирование как классификация</h3>


<p><strong>Районирование как типология и районирование как классификация</strong> – <span class="bolditalic"> своего рода "классика географии", процедуры, предполагающие методы дифференциации (разделения) совокупности матрицы операционно-территориальных единиц (ОТЕ) по одному или нескольким признакам</span>.</p>

<p>Здесь важно не запутаться в понятиях. Простейшая классификация может быть проведена по любому признаку или свойству. Так, если взять значения переменной с континуальной шкалой (например, значения абсолютной высоты), то имея показатель средней высоты для каждого района можно оформить <span class="monospace">картограмму</span>, выбрав, например, 10 классов любым способом (<span class="monospace">равные интервалы</span> или <span class="monospace">естественные границы</span>) и это тоже будет "классификацией", поскольку в результате выделятся  более "высокие", "низкие" или "средневысотные" районы <a href="#01_high_class_10">(Рис. 8.1)</a>.</p>

<div class="script_01">
<figure>
<a id="01_high_class_10"><img src="Pict_2_8/01_high_class_10.png" width="100%" height="relative">
</figure>
<figure>
<a id="01_high_class_10_l"><img src="Pict_2_8/01_high_class_10_l.png" width="20%" height="relative">
</figure>
</div><br>
<span class="imgtitle">Рис. 8.1 Средняя высота поверхности районов "Старой" Москвы - 10 таксонов, выделенных способом "естественные границы"</p>

<p>Сложнее обстоит дело с переменными, выражаемыми ранговыми или номинативными шкалами,  такими как виды геоморфологических поверхностей, или типы земельно-ландшафтного покрова (LULC) – в этом случае единицы ОТЕ (районы) различаются <span class="bolditalic">долей</span> площади каждого класса <a href="#00_geomorpha_moscow">(Рис. 8.2)</a>.</p>

<div class="script_01">
<figure>
<a id="00_geomorpha_moscow"><img src="Pict_2_8/00_geomorpha_moscow.png" width="100%" height="relative">
</figure>
<figure>
<a id="00_geomorpha_moscow_l"><img src="Pict_2_8/00_geomorpha_moscow_l.png" width="60%" height="relative">
</figure>
</div><br>
<span class="imgtitle">Рис. 8.2 Типы геоморфологических поверхностей в пределах административных районов "Старой" Москвы
<br>
<p>Можно строить картограммы по отдельным классам чтобы выяснить, например, какую долю занимают поймы в пределах разных районов. В результате отказа от индивидуальных значений площади пойм и перехода к интервалам значений мы получаем районирование, дифференцирующие районы Москвы по единственному признаку - <span class="bolditalic">доле пойменных поверхностей</span> <a href="#02_poima_dolya_map">(Рис. 8.3)</a>.</p>

<div class="script_01">
<figure>
<a id="02_poima_dolya_map"><img src="Pict_2_8/02_poima_dolya_map.png" width="100%" height="relative">
</figure>
<figure>
<img src="Pict_2_8/02_poima_dolya_l.png" width="20%" height="relative">
</figure>
</div><br>
<span class="imgtitle">Рис. 8.3 Доля пойм в общей площади районов "Старой" Москвы

<p>Но, допустим, что нас интересуют не только поймы, но и все остальные формы рельефа; иными словами, мы хотим получить ответы на два вопроса:<br> 
    <ol>
    <li>Как различаются административные районы Москвы по представленности (есть-нет) и соотношению (доля площади) в их пределах разных форм рельефа?</li>
    <li>Каким образом можно сгруппировать административные районы по этим двум признакам?</li>
</ol>
 <p>Именно в таком порядке был бы озадачен вопросами специалист, пытающийся  провести геоморфологическое "районирование" Москвы по административной сетке.</p>

<p>В современных геоинформационных системах для решения задач классификации множества объектов предлагается несколько инструментов кластерного анализа, которые с легкой руки разработчиков ESRI получили второе наименование (используемые в продуктах семейства ARCGIS) - <span class="blackbold">Анализ Группирования</span>; но мы должны понимать, что в данном случае "группы" это те же "кластеры", т.е., "таксоны" или "классы".</p>

<p>Эти инструменты реализованы в пакетах <span class="red">ArcMAP10.x</span> (<span class="blackbold">Анализ Группирования</span>) и <span class="blue">SAGA GIS</span> (<span class="blackbold">Кластерный Анализ</span>). На наш взгляд имеет смысл применять их в комбинации (т.е., последовательно и совместно) – сравнивая (и выбирая) результаты процедуры, ибо в каждом из программных пакетов есть свои преимущества и свои недостатки.</p>

<p>Все сюжеты классифицирования и районирования можно разделить на две категории. <span class="bolditalic">Первая - сюжеты, когда число конечных классов известно</span>, например, когда  мы решаем задачу разделения множества местоположений по совокупности признаков  на  четыре известных класса (элювиальные, трансэлювиальные, трансаккумулятивные и аккумулятивные), или множество лесных выделов на шесть классов возраста. <span class="bolditalic">Вторая - сюжеты, когда нам неизвестно на какое число классов может быть разделено оптимальным образом множество объектов</span>. Допустим, что есть совокупность водосборов с природными  (гидрологическими, морфометрическими) и антропогенными (распаханность, застроенность)  параметрами, и это множество необходимо разделить на некоторое число классов. Второй сюжет со всей очевидностью значительно сложнее  первого: один эксперт сочтет, что необходимо выделить четыре класса водосборов, но другой может решить, что необходимо, по меньшей мере, семь классов. "Big Data" снабжают нас множеством данных, но зачастую эти данные заранее не "говорят" нам ничего или почти ничего о том, как может быть проведена классификация в многомерном пространстве факторов.</p><br>


	<h3 id="h3_2">8.2. Анализ группирования как способ районирования в ArcMAP</h3>


<p>Задача районирования, понимаемая как <span class="bolditalic">географический вариант более широкой (в общенаучном смысле) задачи классифицирования</span>, распадается на две "подзадачи":</p>
<ul>
<li>Определение условий соседства и "граничности" (число соседей и характер контакта) объектов  (в ГИС-моделировании - полигонов) принадлежащих к одному классу,</li>
<li>Определение оптимального числа классов (таксонов), на которое необходимо разбить множество объектов (районов).</li>
</ul>

<p><span class="bolditalic">На традиционном для географии языке определение условий соседства означает различие между индивидуальным  районированием - когда выделяемые районы одного типа соседствуют между собой (т.е., по сути, формируют единый ареал) и типологическим  районированием, когда районы одного и того же типа могут располагаться в разных ареалах ("кластерах")</span>. <strong>Индивидуальное районирование</strong> часто полагают дедуктивным, т.е., начинающимся сверху (top-down): всю область районирования делят на крупные отличающиеся друг от друга части, а затем на все более мелкие различающиеся ареалы, и каждый из них неповторим, индивидуален. <strong>Типологическое районирование</strong>, напротив индуктивно и начинается снизу (bottom-up): определяется комплекс свойств по которому задается тип и к нему подбираются подходящие, не обязательно расположенные рядом, далее выделяется следующий тип и так далее.</p>

<p>Инструмент <span class="blackbold">Grouping Analysis|Анализ Группирования</span> <span class="red">ArcMAP10.x</span> позволяет задать условия соседства и граничности прозрачным и воспроизводимым образом, что выводит операцию районирования на новый, методически обоснованный уровень. Это обстоятельство важно не только для науки, но (и возможно в большей степени) для практики, поскольку районирование всегда было предметом, по поводу которого "ломались копья" многих научных школ. Классифицирования и районирование (как вариант классификации) были и остаются важным инструментом научного познания. На классификаторы  и схемы районирования разного рода опираются все практики природоохранного регулирования, методы ландшафтного планирования и экологической реабилитации природных объектов, процедуры землеустройства, лесоустройства, подходы стратегического и градостроительного планирования.</p>

<p>Уникальность инструмента <span class="blackbold">Grouping Analysis|Анализ Группирования</span> заключается в том, что, придумав для этого способа классифицирования/районирования/кластеризации новое  название - "группирование" (за что их неоднократно подвергали критике) - специалисты ESRI украсили его "вишенкой на торте", снабдив дополнительной опцией определения <span class="bolditalic">оптимального числа групп</span>. Именно эта особенность привлекает к алгоритму пользователей, решающих самые разнообразные практические задачи.</p>

<p>Следует сразу отметить, что корректность и релевантность определения оптимального числа классов в качестве одного из результатов использования инструмента <span class="blackbold">Grouping Analysis|Анализ Группирования</span> не гарантирована, и в каждом конкретном случае предложенное число групп должно пристально оцениваться экспертом. Мы оставляем за пределами обсуждения отдельный (и почти "философский") вопрос о том, возможно ли вообще решить данную проблему "идеально" безотносительно конкретной задачи. <span class="bolditalic">Обособленность или специфичность любого класса определяется степенью дифференцированности привлеченных к анализу признаков-параметров разделения конкретного множества</span>, но и сами эти признаки - каждый в отдельности -  могут быть сложно распределенными в собственном пространстве.</p> 

<p>Так или иначе, общий  алгоритм <span class="blackbold">Grouping Analysis|Анализ Группирования</span>, может быть представлен следующим образом:</p>
<ol>
<li>Запускаем инструмент Grouping Analysis  <span class="red">ArcMAP10.x</span> для выявления оптимального числа классов, задавая при этом потенциально максимально возможное число- 15;</li>
<li>Изучаем PDF-Отчет на предмет выявления оптимального числа "групп" (классов, или типов районов);</li>
<li>Повторно запускаем Grouping Analysis <span class="red">ArcMAP10.x</span> с выявленным оптимальным числом классов, интерпретируем результат;</li>
<li>Запускаем Cluster Analysis (Shapes) кластеризацию в <span class="blue">SAGA GIS</span> для получения альтернативного варианта классификации в виде "кластеров", интерпретируем кластеры и сравниваем с результатом Анализа Группирования;</li>
<li>Выбираем наиболее адекватный поставленной задаче инвариант дифференциации на группы/кластеры.</li>
</ol>

<p>Продемонстрируем возможности классификации инструментом <span class="blackbold">Анализ Группирования</span> на примере шейп-файла районов "Старой" Москвы с извлеченными значениями доли, занимаемой каждой из 9 типов геоморфологических поверхностей.  Таким образом, задача классификации -  разделить районы Москвы  по  сочетанию (спектру) типов рельефа. </p>
<br>
<img src="Pict_2_8/03_table_shape_geom_type.png" width="90%" height="relative">
<br><span class="imgtitle">Рис. 8.4 Скриншот таблицы исходного шейп-файла районов "Старой Москвы"; значения полей: a1 - гляциально-аккумулятивная равнина, a2 - флювиогляциальная равнина, a3 - днища долин мелких водотоков, a4 - нерасчлененный аллювиальный комплекс, a5 - третья надпойменная терраса, a6 - пойма, a7 - вторая надпойменная терраса, a8 - первая надпойменная терраса, a9 - акватория Москвы-реки</p>

<p>Инструмент <span class="blackbold">Grouping Analysis</span> пакета <span class="red">ArcMAP10.x</span> находится в наборе <span class="monospace">Mapping Clusters</span> группы <span class="monospace">Spatial Statistic Tools</span>; использование предполагает тщательную установку всех необходимых опций - в противном случае результат будет слабо интерпретируем.</p>

<div class="script">
<strong>Grouping Analysis</strong> <br>
Input Features: Old_Moscow_reg <br>	
Unic ID Field: FID <br>	
Output Feature Class: ... Mscw_Reg_Group_15_exprmnt <br>	
Number of Group: 15 (*в первом запуске используем максимально возможное число групп для определения "оптимального" в пределах от 2 до 15) <br>	
Analysis Fields: a1, a2, a3, ... a9 (*перечисляем все поля учитываемых переменных исходной таблицы) <br>	
Spatial Constrains: NO_SPATIAL_CONSTRAINT <br>	
Distance Method: MANHATTAN <br>	
Initialization Method: Find Seeds Locations <br>	
Evaluate Optimal Number of Groups: check <br>	
Output Report File: ... 15_Group_exprmnt.pdf <br>	
</div>
<br>
<div class="script_01">
<figure>
<a id="04_grouping_analysis_window_1"><img src="Pict_2_8/04_grouping_analysis_window_1.png" width="250" height="270"></a>
</figure>
<figure>
<a id="04_grouping_analysis_window_2"><img src="Pict_2_8/04_grouping_analysis_window_2.png" width="250" height="270"></a>
</figure>
</div><br>
<span class="imgtitle">Рис. 8.5 Диалоговое окно инструмента Grouping Analysis ArcGIS10.x</p>

<p>К специфическим (т.е., определяющим параметры работы инструмента) опциям относится <span class="cursive">Number of Group|Число Групп</span>. При первом "прогоне" инструмента для определения оптимального числа будущих групп-классов имеет смысл задать максимум (15) - с большими значениями программа не работает, с другой стороны, непросто представить себе множество, которое мы способны разделить на большее количество классов, и, что важнее, затем подвергнуть их содержательной интерпретации.</p>

<p>Следующее поле - <span class="cursive">Analysis Field</span> - предполагает указание полей, которые будут использоваться для классификации, в данном случае это поле исходного шейп-файла со значениями доли (в %) занимаемой каждым типом поверхности от площади отдельного района АТД Старой Москвы. Количество  полей - т.е., число признаков, привлекаемых для классификации, сказывается на продолжительности работы инструмента. Характер данных полей влияет на результат классифицирования, опять-таки, в разбираемом (простейшем) кейсе все поля качественно однородны и относятся к одному признаку (тип рельефа) и распределены по единой (процентной) шкале. Когда привлекаются разные признаки, существующие в разных шкалах -  результат может быть  мало предсказуемым и в значительной степени зависимым от их подбора и комбинаторики данных.</p>

<p>В нижней части вкладки диалогового окна <span class="blackbold">Grouping Analysis</span> размещены остальные критические опции. Позиция <span class="cursive">Spatial Constrains|Пространственные Ограничения</span> чрезвычайно важна, поскольку она определяет характер будущей классификации. Здесь мы сталкиваемся с традиционным теоретическим дискурсом географии и спорами о том, чем "типологическое"" районирование отличается от "индивидуального" <a href="BIBLIO.html#Гвоздецкий_1979">[Гвоздецкий, 1979]<a>. <span class="bolditalic">С позиций ГИС- моделирования процедуры "индивидуального физико-географического районирования" и "типологического районирования" могут быть осуществлены одним и тем же инструментом  анализа - кластерным анализом - и различаются (1) определением условий соседства полигонов районов, (2) алгоритмом описания граничности и (3) способом измерения расстояний</span>.</p> 

<p>Иными словами, в кейсах <span class="bolditalic">индивидуального районирования</span> мы как бы "идем сверху", в поисках различий разделяем все множество сначала на все более дробные (две, потом три-четыре и так далее) части, и при таком дедуктивном способе полигоны классов в выделяемых частях всегда будут граничить между собой и формировать единый "индивидуальный" (отличающийся от всех других) ареал. Опция, дифференцирующая индивидуальное районирование - характер граничности, поскольку результат будет различаться в зависимости от того как задаются условия соседства: "только углы полигонов", "только стороны полигонов", "углы и стороны полигонов" и т.д. (см. ниже). Заметим, что "угловатость" полигонов, это свойство, которое может быть присуще искусственным объектам (например - городским районам и кварталам, контурам сельскохозяйственных угодий), но которое сложно применять к природным объектам (речным бассейным, ландшафтам, лесным выделам и проч.). Поэтому на эксперта ложится дополнительная задача апробации разных опций соседства и граничности в сочетании с разными способами измерения расстояний между полигонами, а также интерпретации и сравнения результатов.</p>

<p>При <span class="bolditalic">типологическом районировании</span> мы поступаем противоположным "индуктивным" образом: ищем сходные черты у отдельных полигонов и объединяем их, двигаясь снизу, при этом мы полагаем, что районы, принадлежащие к одному типу, не обязательно должны соседствовать между собой (т.е., их полигоны могут иметь, а могут и не иметь общую границу). Все остальные опции соседства и граничности здесь также должны апробироваться и оцениваться экспертно исходя из характера данных и ожидаемого результата.</p>

<p>Выбор траектории моделирования как раз и задается опцией <span class="cursive">Spatial Constrains</span>, предлагающей целый ряд вариантов учета соседства, или взаимного расположения полигонов, а именно:
<ul>
	<li>CONTIGUITY_EDGES_ONLY - класс формируется смежными полигонами, т.е., только полигоны, имеющие общее ребро, могут быть частью одного класса (жесткое условие смежности подходящее для индивидуального районирования);</li>
	<li>CONTIGUITY_EDGES_CORNERS — класс формируется смежными полигонами, но при этом полигонам достаточно иметь общее ребро и/или общую вершину (смягченное условие смежности - полигоны по сути могут касаться друг друга только в одной "угловой" точке);</li>
  <li>DELAUNAY_TRIANGULATION - естественные соседские отношения внутри класса основаны на триангуляции Делоне, полигоны в одном классе должны иметь хотя бы одного общего соседа, граничащего с другим полигоном этого же класса - (другой вариант смягченного условия соседства);</li>
	<li>K_NEAREST_NEIGHBORS — условие соседства, основанное на параметре k-ближайшего, целочисленное значение которого (т.е., сколько смежных полигонов 2,3 ... 8  должен иметь каждый конкретный полигон класса) указывается пользователем (третий, регулируемый вариант смягченного соседства);</li>
	<li>GET_SPATIAL_WEIGHTS_FROM_FILE - пространственные  отношения определяются предварительно формируемым (инструмент Generate Spatial Weights) файлом Пространственных Весов (четвертый, регулируемый вариант смягченного соседства);</li>
  <li>NO_SPATIAL_CONSTRAINT— объекты не обязательно должны находиться рядом друг с другом в пространстве  чтобы быть частью одной группы (класса) - вариант, при котором полигон, принадлежащий к одному классу, может быть окружен полигонами других классов и не иметь соседа, принадлежащего к этому же классу.</li>
</ul>

<p>Таким образом для <span class="bolditalic">типологического районирования</span> подходит только последний шестой вариант, не задающий условий обязательного соседства. Заметим, что выражение <span class="greencursiv">NO_SPATIAL_CONSTRAINT</span> при этом не запрещает соседства, т.е., полигоны относящиеся к одному классу могут как формировать, так и не формировать ареалы из смежных полигонов.</p>

<p>При выборе любого из вариантов смежности следует определить <span class="cursive">Distance Method|Метод вычисления Дистанции</span> между объектами; здесь возможны два варианта: <span class="greencursiv">EUCLIDEAN</span> — оценивается кратчайшее расстояние ("полет вороны"), <span class="greencursiv">MANHATTAN</span> - оценивается как разность дистанций по двум осям координат <strong>X </strong> и <strong>Y</strong>, имитирующая  путь таксомотора по улицам между городскими кварталами - отсюда экзотичное название.</p>

<p>Наконец, последняя опция - указание на оценку оптимального числа групп (классов) - <span class="cursive">Evaluate Optimal Number of Groups</span>, в этой позиции при первом прогоне алгоритма указывается максимально возможное число групп (15), при последующих - рекомендованное и/или экспертное.</p>


<p>После первого прогона инструмента <span class="backbold">Grouping Analysis</span> на выходе новый шейп-файл с <span class="cursive">15</span> ("заказанными") классами, но нас в данном случае больше интересует <span class="monospace">PDF-отчет</span>, который содержит серии таблиц, объясняющие как распределен конкретный признак (скажем доля пойм или террас) при разном числе групп (т.е., типов районов), начиная с 2 групп.</p>

<p>Верхняя схема отчета демонстрирует принцип построения статистического "ящика с усами": в центре ящика – черная линия медианы, значение, выше и ниже которого располагается ровно половина всех значений выборки. Левый и правый края ящика маркируют значение нижней и верхней квартили (четверти из общего числа значений выборки). Наконец левый и правый "ус" показывают соответственно самое низкое и самое высокое значение. Цветная точка-окружность – маркирует среднее арифметическое значение. Все знаки <span class="greencursiv">+</span>, не попадающие в верхний или нижний ящичек, представляют собой <span class="monospace">выбросы</span> в данных. </p>

<img src="Pict_2_8/05_box_wisky.png" width="70%" height="relative">
<br><span class="imgtitle">Рис. 8.6 Ящичковая диаграмма, демонстрирующая распределение статистик</p>

<p>Для каждого числа классов (групп), апробированных утилитой, в файле <span class="monospace">PDF-Отчета</span> построены собственные таблицы значений каждой переменной (<span class="monospace">Mean, Std.Dev, Min, Max, Share</span>) и представлены ящичковые диаграммы. Последовательно просматривая данные таблиц и диаграммы, можно судить о том, насколько удачно распределяется конкретная переменная при данном числе групп: в "хороших" вариантах круглый пунсон <span class="greencursiv">Mean|Средней</span>  должен оказаться внутри "ящика" и располагаться как можно ближе к черте <span class="monospace">медианы</span>. </p>

<img src="Pict_2_8/05_diagram_stat_15_grp.png" width="80%">
<br><span class="imgtitle">Рис. 8.7 Таблица статистик и графики для варианта 14 выходных классов в файле PDF-Отчета</p>

<p>Просматривая цветные серии таблиц, мы можем видеть насколько сильно "разлетаются" значения при заданном числе групп в процессе  перебора программой вариантов от 2 до 15 групп.</p>

<p>Диаграмма  <span class="monospace">Pseudo F-statistic</span> на предпоследней странице <span class="monospace">PDF-Отчета</span> показывает <span class="cursive">Оптимальное число  Групп</span> размещением голубого пунсона на осях диапазона значений <span class="cursive">Minimum-Maximum</span>, при этом <span class="cursive">Mean|Среднее</span> и <span class="cursive">Median|Медианного</span> значения отражены соответственно синим кружочком и красным ромбом. Иногда это разочаровывающе малое число групп-классов:  как в  данном случае всего  <span class="greencursiv">3</span> группы районов <a href="#05_pseudo_f_plot.png">(Рис.8.8)</a>.</p>

<a id="05_pseudo_f_plot"><img src="Pict_2_8/05_pseudo_f_plot.png" width="80%" height="relative">
<br><span class="imgtitle">Рис.8.8 График  Pseudo F-statistic в файле PDF-отчета</p>

<p>В подобной ситуации расхождения результатов группирования с ожиданиями (и здравым смыслом) необходимо прибегнуть к экспертной оценке, т.е., подключить исходный слой геоморфологических поверхностей и наложить сверху прозрачный слой районов Москвы. Внимательно анализируя <a href="#00_geomorpha_moscow">(Рис. 8.2)</a> данные несложно прийти к заключению, что классов районов по "спектру" типов рельефа все же больше чем три. Можно выделить районы следующих типов:</p>

<span class="monospace">
1) с преобладанием акватории и поймы,<br> 
2) с преобладанием акватории, поймы и первой надпойменной террасы,<br> 
3) с абсолютным доминированием надпойменной террасы,<br> 
4) с преобладанием первой и второй надпойменной террас,<br> 
5) с абсолютным доминированием третьей надпойменной террасой,<br>
6) с преобладанием третьей террасы и флювиогляциальной равнины,<br> 
7) с преобладанием гляциально-аккумулятивной моренной возвышенности,<br> 
8) с сочетанием флювиогляциальной и гляциально-аккумулятивной поверхностей.<br></p>
</span>

<p>Экспертный выбор оптимального числа классов (<span class="greencursiv">8</span>) не так уж и плох: обратим внимание на обстоятельство близкого расположения на графике  <span class="monospace">Pseudo F-statistic</span> при числе групп от <span class="greencursiv">6 - 8</span> синего пунсона <span class="cursive">Среднее</span> и красного ромбика <span class="cursive">Медианное</span>. Попытаемся реализовать различные варианты группирования, запустив инструмент с одинаковым числом ожидаемых классов (8) дважды: сначала без пространственный ограничений <span class="monospace">NO_SPATIAL_CONSTRAIN</span>T, затем – с ограничениями <span class="monospace">CONTIGUITY_EDGES_ONLY</span> - условие, при котором класс формируется смежными полигонами, имеющими общее ребро.</p>

<div class="script_01">
<figure>
<a id="06_8_clas_without restrict"><img src="Pict_2_8/06_8_clas_without restrict.png" width="100%" height="relative"></a>
</figure>
<figure>
<a id="06_8_clas_restrict_edges.png"><img src="Pict_2_8/06_8_clas_restrict_edges.png" width="100%" height="relative"></a>
</figure>
</div><br>
<span class="imgtitle">Рис. 8.9 a) результаты Grouping Analysis для восьми классов  без пространственный ограничений, b) результаты Grouping Analysis для восьми классов с ограничениями по соседству с условием общего ребра смежных полигонов </p>

<p> Как и ожидалось, введение условий соседства для группируемых районов переводит всю процедуру с языка <span class="bolditalic">типологического районирования</span> (районы, принадлежащие к одному из восьми типов, могут встречаться в разных частях города) на язык <span class="bolditalic">индивидуального районирования</span> (когда все районы-полигоны данного типа граничат друг с другом и составляют один общий ареал). Таковы результаты с формально-логической точки зрения.  Однако содержательно (с экспертных позиций) они далеко не равнозначны: вариант типологической классификации <a href="#06_8_clas_without restrict">(Рис. 8.9a)</a> в значительно большей степени соответствует нашим представлениям о доминировании и сочетании тех или иных форм рельефа в пределах районов АТД  Москвы. Введенное условие соседства привело к неоправданно широкому обобщению, сформировались классы (например, 6 и 4), которые объединили совсем непохожие районы с преобладанием в одним случаях - аккумулятивных гляциальных равнин, в других - террасового комплекса 
<a href="#06_8_clas_restrict_edges.png">(Рис. 8.9b)</a>.</p>

<p>Оптимизировать результат для <span class="bolditalic">индивидуального районирования</span> возможно увеличивая число классов и меняя условия соседства (например введя условие <span class="cursive">K_NEAREST_NEIGHBORS</span> соседства), но в этом случае следует быть готовым и к более детальной содержательной интерпретации итоговых классов <a href="#06_15_clas_kmeans restrict">(Рис. 8.10)</a>.</p>

<a id="06_15_clas_kmeans restrict"><img src="Pict_2_8/06_15_clas_kmeans restrict.png" width="60%" height="relative">
<br><span class="imgtitle">Рис. 8.10 Результаты Grouping Analysis для 15 классов с  пространственными ограничениями и K_NEAREST_NEIGHBORS условием смежности (соседства) отдельных районов значительно лучше отражают реальные сочетания типов рельефа в районах "Старой" Москвы</p>

<p>Таким образом, успех и корректность классификации и районирования средствами ГИС-анализа  тесно связаны с внимательным отношением к деталям, т.е., опциям построения модели:  <i>"дьявол кроется в мелочах"</i>. Важно помнить три несложных правила:</p>
<ol>
<li>При классифицировании (районировании) без пространственных ограничений результат будет варьировать в зависимости от метода оценки дистанции <span class="bolditalic">Distance Method</span>.</li>
<li>В случае включения опции <span class="bolditalic">Spatial Constraints</span> результат может изменяться (или не изменяться!) при выборе разных условий смежности-соседства.</li>
<li>Группирование радикально трансформируется в зависимости от <span class="bolditalic">числа конечных классов</span> - в общем случае меньшее число классов формирует более обширные ареалы объединенных полигонов, принадлежащих к одному типу, и наоборот, большее число классов создает "островные" кластеры из двух-трех-четырех полигонов, при этом фрагментированность общей мозаики районов всегда будет возрастать с увеличением числа классов.</li>
</ol>


<p>Резюме: если инструмент <span class="blackbold">Grouping Analysis</span> используется для исследовательских целей, то целесообразно попробовать запускать его с разными опциями. Об этом говорится и в соответствующем разделе <a href="https://desktop.arcgis.com/ru/arcmap/10.3/tools/spatial-statistics-toolbox/how-grouping-analysis-works.htm ">(справки АркГИС)</a>, которую всегда полезно изучить до запуска алгоритма.</p>

<p>Интерпретация результатов <span class="blackbold">Анализа Группирования</span> связана с дополнительной необходимостью изучения таблицы выходного шейп-файла "групп" <span class="greencursiv">Reg_Old_Moscow</span> <a href="#06_8_cl_nin_spatail_constrnt_table">(Рис. 8.11)</a>, где номер группы указан в поле <span class="cursive">SS_Group</span>.</p>

<a id="06_8_cl_nin_spatail_constrnt_table"><img src="Pict_2_8/06_8_cl_nin_spatail_constrnt_table.png" width="75%" height="relative">
<br><span class="imgtitle">Рис. 8.11 Таблица шейп-файла групп  - значения классов в поле SS_Group.</p>

<p>Для обобщения параметров и получения представлений о специфике групп можно прибегнуть к одному из трех способов:</p>
<span class="monospace">
<ol>
<li>использовать инструмент <span class="blackbold">Summary Statistics</span> набора <span class="monospace">Statistics</span> группы <span class="monospace">Analysis Tools</span>;</li>
<li>использовать инструмент <span class="blackbold">Dissolve|Слияние</span> - по признаку <span class="cursive">SS_Group</span>;</li>
<li>перебросить таблицу шейпа в Excel (<span class="blackbold">Table to Excel</span>)  и  воспользоваться опцией <span class="cursive">Cводная Таблица</span>.</li>
</ol>

<p>Интерфейс утилиты <span class="blackbold">Summary Statistics|Суммарная Статистика</span> несложен: перечисляем поля расчета средних (в нашем случае это средняя площадь ареалов типов рельефа) и указываем номер группы (кластера) поля  <span class="greencursiv">SS GROUP</span> – в качестве <span class="cursive">Case field</span>.</p>

<a id="06_summury_stat"><img src="Pict_2_8/06_summury_stat.png" width="40%" height="relative">
<br><span class="imgtitle">Рис. 8.12 Интерфейс утилиты Summary Statistics</p>

<p>В выходной таблице <span class="blackbold">Summary Statistics</span> в строке номера каждой группы мы увидим параметр <span class="cursive">Frequency</span>, указывающий сколько административных районов попало в данный тип и далее, по столбцам – среднюю (для типа) долю всех мезоформ рельефа. Таблица позволят нам интерпретировать типы кластеров  (если вспомнить значения переменных в исходном растре геоморфологических поверхностей). Так очевидно, что тип <span class="greencursiv">1</span>  - отличается господством гляциально-аккумулятивных равнин (моренных холмов), а тип <span class="greencursiv">6</span> - это пойма в сочетании с террасами…</p>


<table id="customers">
      <table border="0">
        <tr>
        <td><a id="06_summstat_table_out"><img src="Pict_2_8/06_summstat_table_out.png" width="300" height="relative"></td>
        <td><a id="06_geomorma_type"><img src="Pict_2_8/06_geomorma_type.png" width="250" height="relative"> </td>
            
        </tr>
</table>
<span class="imgtitle">Рис. 8.13 a) таблица значений исходного растра, b) выходная таблица инструмента Summary Statistics с расчитанными показателями для каждой "группы" районов</p>

<p>Полученные в результате <span class="blackbold">Анализа группирования</span> группы значительно различаются по числу входящих в каждую группу районов, в чем легко убедиться построив соответствующий график (View >> Graphs >> Create Graphs) в <span class="red">ArcMAP10.x</span> <a href="#06_diagramm_type">(Рис. 8.14)</a>.</p>

<a id="06_diagramm_type"><img src="Pict_2_8/06_diagramm_type.png" width="65%" height="relative">
<br><span class="imgtitle">Рис. 8.14 Построение графика по числу районов АТД, входящих в каждую группы</p>

<p>Второй путь получения обобщающих характеристик для групп (классов, кластеров) <span class="backbold">Grouping Analysis</span> - использование инструмента <span class="blackbold">Dissolve|Слияние</span> набора <span class="monospace">Geoprocessing</span>. Здесь необходимо указать:</p>

<span class="script">
Dissolve Field: поле слияния - в данном случае это номера групп <span class="greencursiv">SS Group</span>,<br>
Statistic Fields: поля статистики –  переменные,<br> 
Type: тип расчетной статистики - <span class="greencursiv">Mean</span>. 
</span>

<p>Для более глубокого анализа  можно указать полный набор статистик: <span class="monospace">MIN|Минимальное</span>  и <span class="monospace">MAX|Максимальное</span> значение, а также <span class="monospace">RANGE|Разброс значений</span> и <span class="monospace">STD|Среднее квадратическое отклонение</span>, чтобы понимать, насколько в действительности однородные полученные кластеры. Очевидно, что для "поклонников" <span class="red">ArcMAP10.x</span> этот способ обработки результатов <span class="blackbold">Анализа Группирования</span>  более удобен:  поскольку на выходе - и карта, и таблица к ней, что называется, "в одном флаконе". Легко убедиться, кстати, что эта таблица аналогична таблице <span class="monospace">Суммарной Статистики</span>.</p>

<div class="script_01">
<figure>
<a id="07_dissolve_01"><img src="Pict_2_8/07_dissolve_01.png" width="250" height="260">
</figure>
<figure>
<a id="07_dissolve_02"><img src="Pict_2_8/07_dissolve_02.png" width="250" height="260">
</figure>
</div><br>
<span class="imgtitle">Рис. 8.15 Интерфейс инструмента Dissolve пакета ArcMAP10.x</p><br>



<h3 id="h3_3">8.3. Кластеризация  как способ классифицирования в SAGA GIS</h3>

<p>В <span class="blue">SAGA GIS</span> задача районирования (классификации, кластеризации, типологии) векторных данных по атрибутам выполняется инструментом <span class="blackbold">Cluster Analysis</span> (shapes, автор <b>O. Conrad</b>) набора <span class="monospace">Calculus</span> группы <span class="monospace">Table</span>.</p>

<a id="9_saga_custer analysis_interface"><img src="Pict_2_8/09_saga_custer analysis_interface.png" width="70%" height="relative">
<br><span class="imgtitle">Рис. 8.16 Диалоговое окно инструмента Cluster Analysis (shapes) пакета SAGA GIS</p>

<p>Диалоговое окно инструмента <span class="blackbold">Cluster Analysis (shapes)</span> предполагает ввод значений нескольких важных опций:</p>
<ul>
<li>переменные (поля таблицы исходного шейп-файла районов) для анализа выбираются в закладке  <span class="cursive">Attributes</span>;</li>
<li>в полях <span class="cursive">Result</span>  и <span class="cursive">Statistic</span> задаются значение <span class="cursive">create</span> (создать) для формирования шейп-файла кластеров и таблицы со значениями кластеров соответственно;</li>
<li>следующая опция <span class="cursive">Clusters</span> относится к числу классов, которые необходимо указать, поскольку в <span class="blue">SAGA GIS</span> отсутствует возможность определения оптимального числа классов.</li>
</ul>

<p>Искусство моделирования в <span class="blue">SAGA GIS</span> обычно связано с выбором метода (<span class="cursive">Method</span>); и здесь "угадать" непросто,	поэтому есть смысл пробовать разные варианты. <span class="blue">SAGA GIS</span>  предлагает три метода:</p> 
<ul>
<li>Hill-Climbing<a href="BIBLIO.html#Rubin_1967">[Rubin, 1967]</a>, который как утверждается, оптимален для группирования как решения таксономических проблем в биологии;</li>
<li>Iterative Minimum Distance <a href="BIBLIO.html#Forgy_1965"> [Forgy, 1965]</a> - эффективный анализ многомерных данных, помогающий преодолеть "непроницаемость классифицирования";</li>
<li>Combined Minimum Distance/Hill-Climbing - гибридный подход, сочетающий оба метода.</li>
</ul>

<p>Кластеризация в <span class="blue">SAGA GIS</span> происходит почти моментально (отмечаем это специально - в <span class="red">ArcMAP10.x</span> с опцией создания PDF-Отчета и расчетом оптимального числа классов процедура может продлиться многие минуты - в зависимости от числа переменных и количества объектов); программа создает новый шейп-файл с тем же названием, который лучше сразу же переименовать на вкладке установок <span class="cursive">Settings</span> в поле <span class="cursive">Name</span>. Чтобы не запутаться целесообразно использовать в названии выходного шейп-файла имя метода и число классов, например - <span class="backgreencursiv">Cluster_8_Rubin</span>. Для просмотра файл (как обычно в <span class="blue">SAGA GIS</span> добавляется к карте <span class="cursive">Add to Map</span>) и оформляется, по атрибуту <span class="greencursiv">CLUSTER Discrete Colors- 8</span> цветов по числу кластеров <a href="#09_saga_cluster analysis_ruben">(Рис. 8.17)</a>.</p>

<a id="09_saga_cluster analysis_ruben"></a><img src="Pict_2_8/09_saga_cluster analysis_ruben.png" width="75%" height="relative">
<br><span class="imgtitle">Рис. 8.17 Результат кластеризации на 8 классов по методу Hill-Climbing в SAGA GIS </p>

<p>Как уже упоминалось <span class="blackbold">Cluster Analysis</span>  <span class="blue">SAGA GIS</span> одновременно выдает и таблицу Статистики Statistic <a href="#09_cluster analysis_rubin">(Рис. 8.18)</a>, которой лучше дать тоже имя, что и шейпу, и, которая собственно является характеристикой кластеров.</p>

<a id="09_cluster analysis_rubin"></a><img src="Pict_2_8/09_cluster analysis_rubin._table.png" width="80%" height="relative">
<br><span class="imgtitle">Рис. 8.18 Выходная таблица статистики с характеристиками кластеров SAGA GIS </p>

<p>Пробуем запустить кластерный анализ с другими методами кластеризации, для этого надо просто вернутся к закладке <span class="monospace">Method</span> инструмента и поменять значение.  Как можно убедиться – различия не радикальны, но с точки зрения  Ее Величества Геоморфологии - вспоминаем исходный растр типов поверхностей <a href="#00_geomorpha_moscow">(Рис. 8.2)</a> - вариант <span class="cursive">Hill-Climbing Rubin</span> дает лучший результат, на втором месте – <span class="cursive">Combine Method</span>, и хуже других - <span class="cursive">Iterative Minimum Distance</span>.</p>

<div class="script_01">
<picture>
<a id="09_saga_claster_an_rubin_8"><img src="Pict_2_8/09_saga_claster_an_rubin_8.png" width="170">
</picture>
<picture>
<a id="09_saga_claster_an_iterdistance_8"><img src="Pict_2_8/09_saga_claster_an_iterdistance_8.png" width="170">
</picture>
<picture>
<a id="09_saga_claster_an_combined_8"><img src="Pict_2_8/09_saga_claster_an_combined_8.png" width="170">    
</picture>
</div><br>
<span class="imgtitle">Рис. 8.19 Три выходных шейп-файла кластеров (типологических районов), построенных по доле и сочетанию геоморфологических поверхностей тремя различными способами  в SAGA GIS: (1) Hill-Climbing, (2) Iterative Minimum Distance, (3) Combined method</p>

<p>В <span class="blue">SAGA GIS</span> также есть инструмент слияния полигонов для получения обобщенных ареалов по принадлежности к одному кластеру - <span class="blackbold">Polygons Dissolve</span> набора <span class="monospace">Polygon</span>, позволяющий попутно рассчитать стандартный набор статистик. Запуск алгоритма предполагает заполнение обычных позиций: в  <span class="cursive">Dissolve Fields</span>, по которому производится слияние полигонов указываем поле с номерами кластеров, в поле <span class="cursive">Statistic Fields</span> - атрибуты, по которым осуществлялась кластеризация, в позициях перечня рассчитываемых статистик - требуемые показатели, например, <span class="greencursiv">Mean</span>.</p>

<img src="Pict_2_8/09_saga_polygon_dissolve.png" width="40%" height="relative">
<br><span class="imgtitle">Рис. 8.20 Интерфейс инструмента Polygons Dissolve SAGA GIS</p>

<p>Новый  шейп-файл генерируется программой с добавлением к исходному названию <span class="greencursiv">[Dissolved: CLUSTER]</span>; для просмотра шейп необходимо добавить к карте и оформить по атрибуту <span class="cursive">Cluster</span> как <span class="cursive">Discreet Colors</span> <span class="cursive">8 цветов</span>.</p>

<p>Поместим шейп-файл кластеров <span class="blue">SAGA GIS</span> в окно <span class="red">ArcMAP10.x</span>  для сравнения с полученным ранее файлом <strong>групп</strong>. Можно видеть <a href="#09_sagaarc_cluster_diss_8">(Рис. 8.21)</a>, что два разных алгоритма (при равном числе классов) привели к результатам, имеющим как сходство, так и различия. Сходство (и это закономерно) касается очертаний самых крупных ареалов аккумулятивных гляциальных равнин, долинных ландшафтов,  обширных водно-ледниковых равнин и высоких террас. Различия (т.е., разная компоновка районов в классы) наблюдаются в тех частях Москвы, где распространены более 3-х типов геоморфологических поверхностей, и где особенности алгоритмов начинают играть заметную роль. Эти обстоятельства следует учитывать эксперту при выборе инструментов (<span class="blackbold">Grouping Analysis</span> <span class="red">ArcMAP10.x</span> и <span class="blackbold">Cluster Analysis</span> <span class="blue">SAGA GIS</span>) и опций, сопоставляя их с целями и задачами конкретного исследования.</p>

<div class="script_01">
<figure>

</figure>
<figure>
<
</figure>
</div>

<table id="customers">
      <table border="0">
        <tr>
        <td><a id="09_sagaarc_cluster_diss_8"><a id="09_sagaarc_cluster_diss_8"></a><img src="Pict_2_8/09_sagaarc_cluster_diss_8.png" width="250" height="relative"></td>
        < <td><a id="09 arc_8_clas_without restric_diss"><img src="Pict_2_8/09 arc_8_clas_without restric_diss.png" width="250" height="relative"></td>
            
        </tr>
</table>

<br><span class="imgtitle">Рис. 8.21 Сравнение результатов классификации методом "кластеризации" SAGA GIS и "группирования" ArcMAP</p>
<br>


<h3 id="h3_4">8.4. Районирование по набору разнородных признаков</h3>

<p>Рассмотренный выше сюжет не является сложным, поскольку ГИС-алгоритмы  кластеризации применены здесь к объектам, "нагруженным" единственной характеристикой - спектру типов геоморфологических поверхностей в пределах административных районов Москвы. Как мы могли убедиться данная задача вполне может быть решена и экспертно  - посредством визуального анализа наложенных друг на друга слоев. Однако экспертное районирование становится почти невозможным, если множество объектов необходимо разделить по набору нескольких разных признаков.</p>

<p>Предположим, что необходимо провести районирование Москвы с использованием параметров, характеризующих, с одной стороны - техногенную нагрузку, с другой - средостабилизирующий потенциал территории. В качестве некоторого упрощения примем, что районирование будет производится по картометрическим данным - имеющимся в нашем распоряжении слоям <span class="backgreen">Open Street Map</span>. Косвенно, т.е., картометрически техногенная нагрузка может быть учтена по следующим параметрам:</p>

<ol>
<li>Плотность застройки, (т.е., доля, занимаемая основаниями зданий и сооружений от общей площади административного района),</li>
<li>Доля площадей, занимаемых промышленными предприятиями,</li>
<li>Плотность автодорожной сети,</li>
<li>Плотность железнодорожных путей.</li>
</ol>


<p>Все четыре показателя легко получить операцией извлечения данных <span class="blackbold">Tabulate Intersection</span>  в <span class="red">ArcMAP10.x</span>,  или <span class="blackbold">Line-Polygon Intersection</span>  в <span class="blue">SAGA GIS</span> (см. раздел <a href="#book_2_7.html.html h3_6">Инструменты извлечения дисперсных векторных данных</a> и раздел <a href="#book_2_7.html.html h3_7">Инструменты извлечения данных векторных "мозаик"</a>). Параметр плотности дорожной сети и железнодорожных путей рассчитывается делением общей длины коммуникаций в пределах района на площадь района.</p>

<div class="script_01">
<figure>
<a id="Density_Buildings"><img src="Pict_2_8/Density_Buildings.png" width="100%" height="relative">
</figure>
<figure>
<a id="Density_Industrial"><img src="Pict_2_8/Density_Industrial.png" width="100%" height="relative">
</div><br>
<span class="imgtitle">Рис. 8.22 Исходные параметры для районирования техногенной нагрузки по сетке АТД "Старой" Москвы: а) плотность застройки, b) доля промышленных площадок</span></p>
<br>
<div class="script_01">
<figure>
<a id="Density_Auto"><img src="Pict_2_8/Density_Auto.png" width="100%" height="relative">
</figure>
<figure>
<a id="Density_Rail"><img src="Pict_2_8/Density_Rail.png" width="100%" height="relative">    
</figure>
</div><br>
<span class="imgtitle">Рис. 8.23 Исходные параметры для районирования техногенной нагрузки по сетке АТД "Старой" Москвы:  a) плотность автомобильных дорог, b) плотность железнодорожных путей.</span></p>

<p>Выбранные параметры позволяют нам (в первом приближении) оценить <span class="bolditalic">техногенное воздействие</span>: плотность застройки определяет общую запечатанность поверхности, следовательно - изменение температурного режима приземного слоя атмосферы и условий дренирования выпадающих осадков; доля промышленных площадок косвенно влияет на объемы выбросов в атмосферу, плотность автодорожной сети оказывает влияние на напряженность транспортного трафика и, опять же, - объемы неорганизованных выбросов, наконец, железнодорожные пути "ответственны" за физические (шум, вибрация) воздействия. При желании (и наличии данных) модели можно добавить прочие факторы "экологической напряженности" - линии высоковольтных электропередач, антенны мобильной (сотовой) связи и т.д.</p>

<p>Существующие <span class="bolditalic">средостабилизирующие факторы городской среды</span> также можно оценить с помощью сравнительно простых картометрических показателей,  к которым прежде всего необходимо отнести долю территорий с зелеными насаждениями (любого типа) и долю акваторий. К этим данным можно добавить параметры диапазона высот, определяющие динамику аэрации и особенности дренажа территорий: на холмистых и пересеченных участках воздушные потоки как правило более активны, углубленные речные долины обычно лучше "продуваются", эрозионно-расчлененные территории, всегда лучше дренированы и менее подвержены подтоплению.</p>
<br>

<div class="script_01">
<picture>
<a id="ДИАПАЗОН ВЫСОТ"><img src="Pict_2_8/ДИАПАЗОН ВЫСОТ.png" width="32%" >
</picture>
<picture>
<a id="PERCNTG_GREEN"><img src="Pict_2_8/PERCNTG_GREEN.png" width="32%" >
</picture>
<picture>
<a id="PERCNTG_WATER"><img src="Pict_2_8/PERCNTG_WATER.png" width="32%" >    
</picture>
</div><br>
<span class="imgtitle">Рис. 8.24 Исходные параметры для районирования средостабилизирующего потенциала по сетке АТД "Старой" Москвы: а) диапазон высот (м), b) доля зеленых насаждений (%), c) доля акваторий (%)</span></p>


<p>Имея в распоряжении файлы полигонов с извлеченными значениями факторов-характеристик в отдельных полях мы можем приступить к типологическому районированию/классификации сначала отдельно по спектру техногенных нагрузок и средостабилизирующему потенциалу, затем - по совокупности и тех, и других признаков.</p>

<p>Используем инструмент <span class="blackbold">Grouping Analysis|Анализ Группирования</span> для полуавтоматического определения оптимального числа классов (типов районов) по характеру техногенной нагрузки.</p>

<div class="script"></b>
<b>Grouping Analysis</b>
Unique ID Field: номер района,<br>
Number of Groups: 15 (*максимально возможное число групп),<br>
Analysis Fields: вводим поля со значениями плотности застройки, доли промышленных территорий, плотности автодорог и железнодорожных путей,<br>
Spatial Constraints:  NO_SPATIAL_CONSTRAINT, (*условие без пространственных ограничений, в этом случае используется алгоритм K-средних),<br>
Evaluate Optimal Number of Groups: check (*заказываем расчет оптимального числа групп),<br>
Output Report File (optional): указываем место сохранения файла PDF-отчета.</p>
</div>


<p>В данном случае нас интересует не столько результат группирования, сколько <span class="monospace">PDF-отчет</span>, показывающий распределение значений по четырем выбранным факторам. Проанализируем отчет немного более детально, чем мы это делали выше. Таблица первого раздела <a href="#ТЕХНО_4_ПЕРЕМЕННЫХ">(Рис. 8.25)</a> содержит информацию о следующих характеристика: <span class="cursive">Mean|Среднее, StdDev|Среднеквадратичное отклонение, Min|Минимум, Max|Максимум</span> и значения коэффициента детерминации <span class="cursive">R<sup>2</sup></span> для всех данных в каждом поле анализа. Чем больше значение <span class="cursive">R<sup>2</sup></span> для определенной переменной, тем лучше переменная дифференцирует объекты. </p>

<a id="ТЕХНО_4_ПЕРЕМЕННЫХ"></a><img src="Pict_2_8/ТЕХНО_4_ПЕРЕМЕННЫХ.png" width="80%">
<br>
<span class="imgtitle">Рис. 8.25 Сводная статистика четырех использованных переменных: P_auto - плотность автодорог, SUM_Percnt - доля промплощадок, P_rail - плотность железных дорог, BUILDING - плотность застройки</span></p>

<p>В нашем случае все переменные значимы - значения <span class="cursive">R<sup>2</sup></span> больше <span class="greencursiv">0,5</span>, но при этом большая дифференцирующая роль принадлежит параметрам плотности железных дорог и плотности застройки.</p>

<p>В этом же первом разделе в таблицах, характеризующих коэффициенты (для конкретного числа групп), параметр <span class="cursive">Share</span> показывает сколько процентов значений попадает в диапазон между верхней и нижней квартилями, и на этом основании можно судить об эффективности классифицирования. Ящичковые диаграммы справа помогают убедиться в этом визуально: при хорошем разделении цветные точки,  отображающие "групповое <span class="cursive">Среднее</span>", не должны вылетать за пределы "ящика" и чем ближе <span class="cursive">Среднее</span> к <span class="cursive">Медиане</span> (поперечной линии) - тем лучше. В нашем случае <a href="#ПЕРЕМЕНН_5_ГРУПП_15_техно_проба">(Рис. 8.26)</a> такая картина наблюдается только при числе групп - <span class="greencursiv">5</span> или <span class="greencursiv">6</span>.</p>

<br>
<a id="ПЕРЕМЕНН_5_ГРУПП_15_техно_проба"><img src="Pict_2_8/ПЕРЕМЕНН_5_ГРУПП_15_техно_проба.png" width="80%"></a>
<a id="ПЕРЕМЕНН_6_ГРУПП_15_техно_проба"><img src="Pict_2_8/ПЕРЕМЕНН_6_ГРУПП_15_техно_проба.png" width="80%">
<br>
<span class="imgtitle">Рис. 8.26 Скриншоты первого раздела PDF отчета, фрагмент для 5 групп и 6 групп: P_auto - плотность автодорог, SUM_Percnt - доля промплощадок, P_rail - плотность железных дорог, BUILDING  - плотность застройки</span></p>

<p>Во втором разделе <span class="monospace">PDF-отчета</span> сведены значения статистик по отдельной переменной для всех инвариантов анализа с различным числом групп. Иными словами, в таком представлении данных легко увидеть, какое количество групп было бы оптимальным для каждой переменной (точка среднего значения максимально приближена к медиане).</p>
<br>
<a id="ПЛОТНОСТЬ_ЗАСТРОЙКИ_РАСПРЕДЕЛЕНИЕ"></a><img src="Pict_2_8/ПЛОТНОСТЬ_ЗАСТРОЙКИ_РАСПРЕДЕЛЕНИЕ.png" width="80%">
<br>
<span class="imgtitle">Рис. 8.27 Распределение признака Плотность застройки при разном числе групп
<br>

<p>Например, очевидно, <a href="#ПЛОТНОСТЬ_ЗАСТРОЙКИ_РАСПРЕДЕЛЕНИЕ">(Рис. 8.27)</a> что оптимальным для признака <span class="cursive">Плотность застройки</span> является <span class="greencursiv">8 групп</span>. Однако для других признаков - это иное число, для доли промышленной застройки - <span class="greencursiv">7 групп</span>, для плотности железнодорожных путей - <span class="greencursiv">11</span>.</p>

<p>Последний раздел <span class="monospace">PDF-отчета </span> - график значений <span class="monospace">pseudo-F-statistic</span>: голубой пунсон на графике – это наибольшая F-статистика, указывающая оптимальное число групп для различения указанных объектов по набору привлеченных переменных. В нашем случае пунсон <a href="#Pseudo F-Statistic Plot_Техно">(Рис. 8.28)</a> перекрывает значение <span class="greencursiv">5 групп</span>; но и 6 "тоже хорошее решение" как пишут в Руководстве по <span class="red">ArcMAP10.x</span>, предполагая, что эксперт может при необходимости выбрать по своему вкусу и соседние значения (т.е., <span class="greencursiv">4</span> либо <span class="greencursiv">6</span>). </p>

<a id="Pseudo F-Statistic Plot_Техно"></a><img src="Pict_2_8/Pseudo F-Statistic Plot_Техно.png" width="65%">
<br>
<span class="imgtitle">Рис. 8.28 Итоговый график отчета Анализ группирования Pseudo F-Statistic</span></p>

<p>Добавим, что зачастую в поисках подходящего решения инструмент <span class="blackbold">Анализ Группирования</span> приходится запускать неоднократно, меняя число классов и условия соседства. К сожалению, следует признать, что инструмент не вполне совершенен: <span class="bolditalic">иногда разные результаты можно получить, даже запуская скрипт повторно с одними же и теми параметрами</span>. Имея ввиду это обстоятельство в качестве эксперимента запустим <span class="blackbold">Анализ Группирования</span>. для 6 классов: сначала без пространственных ограничений, затем - с условием соседства районов по ребру или вершине <span class="cursive">CONTIGUITY_EDGES_CORNERS</span>.</p>

<div class="script_01">
<figure>
<a id="ТИПЫ_Р_ТЕХНО_6_без_огран"></a><img src="Pict_2_8/ТИПЫ_Р_ТЕХНО_6_без_огран.png" width="100%" height="relative">
</figure>
<figure>
<a id="ИПЫ_Р_ТЕХНО_6_ребро_вершина"></a><img src="Pict_2_8/ТИПЫ_Р_ТЕХНО_6_ребро_вершина.png" width="100%" height="relative">    
</figure>
</div>

<br><span class="imgtitle">Рис. 8.29 Результат анализ районирования "Старой" Москвы на 6 групп по четырем переменным техногенной нагрузки: а) без пространственных ограничений, b) с условием соседства по вершине или ребру полигона</span></p>

<p>Две картограммы <a href="#ТИПЫ_Р_ТЕХНО_6_без_огран">(Рис. 8.29)</a> ярко иллюстрируют различие между "типологическим" и "индивидуальным" районированием: в классификации без пространственных ограничений мы получаем типологические районы, когда один тип (например <span class="greencursiv">тип района 1</span>) располагается в 10 разных ареалах, в варианте индивидуального районирования с условиями соседства однотипных полигонов - перед нами целостные "районы". При этом очевидно, что во втором случае алгоритм явно "пожертвовал" объективностью в пользу задачи агрегирования полигонов районов АТД в общие ареалы.</p>

<p><span class="bolditalic">Единственный критерий удачности классификации (и районирования) - возможность корректной интерпретации полученных результатов</span>: проверим вариант типологического районирования используя итоговую карту <a href="#ТИПЫ_Р_ТЕХНО_6_без_огран">(Рис. 8.29a)</a> и сводную таблицу значений переменных для шести групп <a href="#ТИПЫ_Р_ТЕХНО_6_без_огран_Свод_Табл">(Рис. 8.30)</a>.</p>
 
<a id="ТИПЫ_Р_ТЕХНО_6_без_огран_Свод_Табл"></a><img src="Pict_2_8/ТИПЫ_Р_ТЕХНО_6_без_огран_Свод_Табл.png" width="80%">
<br><span class="imgtitle">Рис. 8.30 Сводная таблица значений переменных  для шести групп АТР</span></p>


<p>Попытаемся интерпретировать классификацию районов Москвы  инструментом <span class="blackbold">Анализ Группирования</span> по привлеченным переменным, косвенно отображающим техногенную нагрузку на городскую среду. Опыт показывает, что самый простой способ истолкования  результатов - это просмотр переменных-критериев и выбор максимальных (условные 1-е и 2-е места) и минимальных значений (последнее и предпоследнее места) позиций, поскольку именно по этим значениям алгоритм и распределял группы.</p>
<ul>
<li><strong>1-я группа</strong> ("синяя") распространена вдоль периферии Москвы, занимает  среднюю (по сумме всех районов АТД) площадь 165 км<sup>2</sup>, имеет показатели плотности застройки и плотности автодорог ниже средних, но при этом - <span class="bolditalic">самую высокую долю промышленной застройки (38,1%)</span> - именно этот показатель "вычленил" данный класс из множества административных районов;</li>
<li><strong>2-я группа</strong>  ("красная") также  расположена в основном во внешнем кольце городской ткани Старой Москвы, но при этом имеет показатели резко отличные от первой  - <span class="bolditalic">самую низкую плотность застройки (8,9%), самый низкий показатель доли индустриальных площадок (4,2%) и самый низкий показатель плотности автомобильных и железных дорог</span>, таким образом перед нами самая "ненагруженная" группа;</li>
<li><strong>3-я группа</strong> ("зеленая")  <span class="bolditalic">выделилась по признаку высокой (второе место) доли промышленных площадок </span>и, относительно низкой плотности автомобильных и железных дорог;</li>
<li><strong>4-я  группа</strong>  ("оранжевая") отличается внутренним расположением (ее ареалы ближе к центру Москвы) средней степенью застроенности, средней плотностью автомобильных и железных дорог и средней долей промышленных площадок, таким образом эта <span class="bolditalic">группа не имеет экстремальных значений ни по одному показателю и является "средней"</span>;</li>
<li><strong>5-я  группа</strong>  ("фиолетовая") относится к центру Москвы и выделилась прежде всего по <span class="bolditalic">максимальной плотности застройки (25,2%) и максимальной плотности железных дорог</span> - что неудивительно поскольку данный тип представлен единственным ареалом, в который попадает "площадь трех вокзалов" - таким образом уникальность данного типа не подлежит сомнению;</li>
<li><strong>6-я группа</strong> ("терракотовая") занимает центр Москвы и характеризуется прежде всего <span class="bolditalic">максимальной плотностью автодорог и высокой плотностью застройки (второе место)</span>.</li>
</ul>

<p>Таким образом, алгоритм вполне корректно справился с поставленной задачей - типологическим районированием по предложенным четырем признакам. Результаты могут быть достаточно корректно и содержательно интерпретированы, каждый тип вычленился благодаря присущим ему одному-двум максимальным  или минимальным значениям. Становится понятным также и рекомендованное (в файле отчета на графике) <span class="monospace">Pseudo F-Statistic</span> число групп - 5, поскольку сделанный нами выбор в пользу шести групп привел к появлению класса, представленного всего одним ареалом (группа <span class="greencursiv">5</span>, который при пяти группах был бы включен в состав центральной  "терракотовой" группы  <span class="greencursiv">6</span>.</p>
 </p>

<p>Проведем <span class="blackbold">Анализ Группирования</span> для районирования единиц АТД Старой Москвы по трем выбранным природным факторам: диапазону высот, удельной площади зеленых насаждений, удельной площади акваторий.</p>

<p>По первой таблице <span class="monospace">PDF-отчета</span> <a href="#ПЕРЕМЕННЫЕ_ПРИРОДА_15_статистики">(Рис. 8.31)</a> определяем относительный вклад факторов в дифференциацию.</p>

<a id="ПЕРЕМЕННЫЕ_ПРИРОДА_15_статистики"></a><img src="Pict_2_8/ПЕРЕМЕННЫЕ_ПРИРОДА_15_статистики.png" width="60%">
<br><span class="imgtitle">Рис. 8.31 Сводная статистика трех использованных переменных классификации: Water areas (удельная площадь акваторий), Green areas (удельная площадь зеленой инфраструктуры), H_Range (диапазон высот)</span></p>

<p>Определяем ориентировочное число групп по ящичковым диаграммам <a href="#ЯЩИК_ПРИРОДА_3группы">(Рис. 8.32)</a> первого раздела отчета - точки "среднего" по всем трем параметрам находятся внутри "ящика с усами" между верхней и нижней квартилями только при условии числа групп равного <span class="greencursiv">4</span>.</p>

<div class="script_01">
<figure>
<a id="ЯЩИК_ПРИРОДА_3группы"></a><img src="Pict_2_8/ЯЩИК_ПРИРОДА_3группы.png" width="90%" height="relative">
</figure>
<figure>
<a id="ЯЩИК_ПРИРОДА_4группы"></a><img src="Pict_2_8/ЯЩИК_ПРИРОДА_4группы.png" width="90%" height="relative"> 
</figure>
</div><br>

<div class="script_01">
<figure>
<a id="ЯЩИК_ПРИРОДА_5группы"></a><img src="Pict_2_8/ЯЩИК_ПРИРОДА_5группы.png" width="90%" height="relative">
</figure>
<figure>
<a id="ЯЩИК_ПРИРОДА_6группы"></a><img src="Pict_2_8/ЯЩИК_ПРИРОДА_6группы.png" width="90%" height="relative">
</figure>
</div>
<br><span class="imgtitle">Рис. 8.32 Сравнение ящичковых диаграмм из первого раздела PDF-отчета для 3-х, 4-х, 5-ти и 6-ти групп соответственно</span></p>

<p>Запустив <span class="blackbold">Анализ Группирования</span> (без пространственных ограничений) для 4-х групп получаем полигональный векторный слой типов районов "Старой" Москвы по трем выбранным признакам, косвенно отражающий средостабилизирующий потенциал территории <a href="#ТИПЫ_Р_ПРИРОД_4_без_огран">(Рис. 8.33)</a>. Далее получаем итоговую таблицу усредненных переменных процедурой слияния <span class="blackbold">Dissolve</span> по номеру группы. Для сравнения дополнительно запустим <span class="blackbold">Анализ Группирования</span>  с условием соседства <span class="cursive">CONTIGUITY_EDGES_CORNERS</span>, а затем с условием соседства <span class="cursive">K_NEAREST_NEIGHBORS</span>.</p>

<div class="script_01">
<figure>
<a id="ТИПЫ_Р_ПРИРОД_4_без_огран"></a><img src="Pict_2_8/ТИПЫ_Р_ПРИРОД_4_без_огран.png" width="300" height="relative">    
</figure>
<figure>
<img src="Pict_2_8/ТИПЫ_Р_ПРИРОД_4_без_огра_Diss_Tableн.png" width="80%" height="relative">
</figure>
</div><br>
<br><span class="imgtitle">Рис. 8.33  Результат анализа группирования  АТД Старой Москвы на 4 группы по трем природным переменным без пространственных ограничений: a) картограмма, b) сводная таблица параметров четырех классов, выделенных по природным признакам</span></p>

<p>Интерпретация групп не представляет особой сложности, так как их различия вполне очевидны:</p>

<ul>
<li><strong>1-я (красная) группа</strong> имеет самый незначительный диапазон высот и одновременно имеет самую низкую долю озелененных территорий и акваторий,</li>
<li><strong>2-я (зеленая) группа</strong> выделяется максимальной долей озеленения (32,6%) и "перекрывает" все парки и крупные ООПТ Москвы,</li>
<li><strong>3-я (желтая) группа</strong> вычленилась по максимальному диапазону высот (68 м - что объяснимо, т.к., в ее пределы попали холмы и разделяющие их небольшие долины притоков Москвы-реки),</li>
<li><strong>4-я группа</strong> при почти столь же высоком диапазоне высот содержит самую большую долю акваторий (12,5%) и практически полностью агрегирует административные территории в окрестностях крупнейшей долины Москвы-реки.</li>
</ul>

<p>Легко убедиться что задачи "индивидуального районирования" с небольшим числом классов решаются <span class="blackbold">Анализом Группирования</span> не слишком удачно и изменение условий соседства хоть и влияет на результат, но итоговую картину не слишком оптимизирует. Против ожидания и увеличение числа "индивидуальных районов" с 4 до 6 не спасает ситуацию.</p>

<div class="script_01">
<figure>
<a id="ТИПЫ_Р_ПРИРОД_4_углы_ребра"></a><img src="Pict_2_8/ТИПЫ_Р_ПРИРОД_4_углы_ребра.png" width="100%" height="relative">    
</figure>
<figure>
<a id="ТИПЫ_Р_ПРИРОД_4_delone"></a><img src="Pict_2_8/ТИПЫ_Р_ПРИРОД_4_delone.png" width="100%" height="relative"><p></p>    
</figure>
</div><br>

<div class="script_01">
<figure>
<a id="ТИПЫ_Р_ПРИРОД_4_k_nearest"></a><img src="Pict_2_8/ТИПЫ_Р_ПРИРОД_4_k_nearest.png" width="100%" height="relative">    
</figure>
<figure>
<a id="ТИПЫ_Р_ПРИРОД_6_k_nearest"></a><img src="Pict_2_8/ТИПЫ_Р_ПРИРОД_6_k_nearest.png" width="100%" height="relative">    
</figure>
</div>

<br><span class="imgtitle">Рис. 8.34 Картограммы индивидуального районирования по трем природным переменным с  различными условиями соседства и граничности: а) 4 группы с условием соседства по вершине или ребру полигона, b) 4 группы - естественные соседские отношения основаны на триангуляции Делоне, c) 4 группы с условием k-nearest, d) 6 групп с условием k-nearest</span>

<p>Таким образом, <span class="blackbold">Grouping Analysis</span>  <span class="red">ArcMAP10.x</span> и <span class="blackbold">Cluster Analysis</span> <span class="blue">SAGA GIS</span> - два эффективных и богатых по заложенным в них возможностям инструмента, которые позволяют осуществлять процедуры классификации географических объектов в форме индивидуального и типологического районирования. Однако их использование предполагает глубокое и вдумчивое погружение в содержание проблематики районирования и хорошее знание привлеченных переменных. Критическим моментом является необходимость четкого разделения дедуктивной и индуктивной траекторий классифицирования, соответствующих индивидуальному и типологическому районированию. Следует понимать. что алгоритм <span class="blackbold">Анализ Группирования</span> <span class="red">ArcMAP10.x</span> с опцией без пространственных ограничений является <strong>k-means (k-средние) кластеризацией</strong>, и в этом плане весьма близок к алгоритмам <span class="blackbold">Кластерного Анализа</span>  <span class="blue">SAGA GIS</span>. Каждый из алгоритмов имеет свои преимущества и недостатки: <span class="blackbold">Анализ Группирования</span> содержит понятные и воспроизводимые опции учета соседства  и предлагает (пусть и не вполне совершенный) способ определения оптимального числа групп (классов/таксонов). <span class="blackbold">Кластерный Анализ</span> намного быстрее работает (что может оказаться немаловажным при районировании множества объектов с привлечением значительного числа переменных) и позволяет использовать три разных метода кластеризации. Но и алгоритм <span class="red">ArcMAP10.x</span>, и инструмент <span class="blue">SAGA GIS</span> предполагают внимательное сопровождение и контроль со стороны эксперта, в противном случае велика вероятность получения результатов, которые невозможно будет содержательно интерпретировать.</p>
<p>Следует также иметь ввиду, что в зарубежной англоязычной географии (не переживавшей длительных теоретических дискуссий по поводу типологического  и индивидуального районирования, порожденных, главным образом, российским ландшафтоведением) первый вариант пространственной классификации районов часто называют <span class="bolditalic">Zoning (зонирование)</span>, а второй - <span class="bolditalic">Regionalizing (регионализация)</span> <a href="BIBLIO.html#Bailey_2009">[Bailey, 2009]</a>, что, в общем и целом, неплохо соответствует содержанию данных процедур.</p>

<br>
	

<footer id="main-footer">Пространственный анализ в геоэкологии &copy; Е.Ю.Колбовский, 2022 </footer>
</div>

</body>
</html>